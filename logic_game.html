<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Logic Quest</title>
  <style>
    :root{
      --bg:#f4f7fb;
      --card:#fff;
      --ink:#2d3436;
      --accent:#0984e3;
      --shadow:0 10px 30px rgba(0,0,0,.15);
    }
    *{box-sizing:border-box}
    body{
      margin:0; min-height:100vh;
      display:flex; align-items:center; justify-content:center;
      background:var(--bg); font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,"Helvetica Neue",Arial;
      color:var(--ink);
    }
    .wrap{
      width:min(680px,94vw); background:var(--card); border-radius:20px; box-shadow:var(--shadow);
      padding:28px; text-align:center;
    }
    h1{margin:0 0 8px; font-weight:800; letter-spacing:.2px; color:var(--accent)}
    #question{font-size:clamp(18px,2.4vw,22px); margin:8px 0 16px; min-height:28px}
    #pattern{display:flex; gap:14px; justify-content:center; align-items:center; min-height:84px; margin:6px 0 10px}
    #pattern .qmark{font-size:48px; color:#9aa0a6}
    #grid{
      display:grid; gap:14px; justify-content:center;
      grid-template-columns:repeat(auto-fit, minmax(96px, 1fr));
    }
    .choice{
      background:#f1f5f9; border:2px solid #d3dae3; border-radius:14px;
      height:110px; display:flex; align-items:center; justify-content:center;
      cursor:pointer; transition:.18s ease; user-select:none;
    }
    .choice:active{transform:scale(.98)}
    .choice.correct{animation:pop .28s ease}
    .choice.wrong{animation:shake .28s ease}
    @keyframes pop{50%{transform:scale(1.06)}}
    @keyframes shake{20%{transform:translateX(-4px)} 40%{transform:translateX(4px)} 60%{transform:translateX(-3px)} 80%{transform:translateX(3px)}}

    /* Shape canvas */
    .shape-wrap{width:70px; height:70px; position:relative}
    /* circle */
    .circle{width:100%;height:100%;border-radius:50%; background:var(--shape-color)}
    /* square */
    .square{width:100%;height:100%;background:var(--shape-color); border-radius:12px}
    /* heart (pure CSS) */
    .heart{position:relative; width:70px; height:62px; transform:translateY(4px)}
    .heart::before,.heart::after{
      content:""; position:absolute; width:36px; height:56px; background:var(--shape-color);
      border-radius:36px 36px 0 0; top:0;
    }
    .heart::before{left:18px; transform:rotate(-45deg); transform-origin:0 100%}
    .heart::after{left:0; transform:rotate(45deg); transform-origin:100% 100%}

    /* subtle focus for accessibility */
    .choice:focus-visible{outline:3px solid #8ab4f8; outline-offset:2px}
  </style>
</head>
<body>
  <div class="wrap">
    <h1>Logic Quest</h1>
    <div id="question">Loadingâ€¦</div>
    <div id="pattern"></div>
    <div id="grid" aria-label="Answer choices"></div>
  </div>

  <!-- Sounds -->
  <audio id="snd-ok" src="https://actions.google.com/sounds/v1/cartoon/clang_and_wobble.ogg" preload="auto"></audio>
  <audio id="snd-buzz" src="https://actions.google.com/sounds/v1/alarms/beep_short.ogg" preload="auto"></audio>

  <script>
    // ---------- Data ----------
    const COLORS = {
      red:"#e74c3c", blue:"#3498db", green:"#2ecc71", yellow:"#f1c40f",
      purple:"#9b59b6", orange:"#e67e22", black:"#2d3436", brown:"#8e5a33"
    };
    const COLOR_NAMES = Object.keys(COLORS);
    const SHAPES = ["circle","square","heart"];

    // ---------- State ----------
    let correctKey = "";           // e.g. "circle:red"
    let speechEnabled = false;     // browsers require a user gesture first
    let currentQuestion = "";

    const elQ = document.getElementById("question");
    const elPattern = document.getElementById("pattern");
    const elGrid = document.getElementById("grid");
    const sndOK = document.getElementById("snd-ok");
    const sndBuzz = document.getElementById("snd-buzz");

    // Enable voice/audio on first user interaction
    window.addEventListener("pointerdown", () => { speechEnabled = true; speak(currentQuestion); }, { once:true });

    // ---------- Utils ----------
    function rand(arr){ return arr[Math.floor(Math.random()*arr.length)]; }
    function shuffle(a){ for(let i=a.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1)); [a[i],a[j]]=[a[j],a[i]];} return a; }
    function speak(text){
      if(!speechEnabled || !("speechSynthesis" in window)) return;
      const synth = window.speechSynthesis;
      synth.cancel();
      const u = new SpeechSynthesisUtterance(text);
      u.lang = "en-US"; u.rate = 0.95; u.pitch = 1;
      synth.speak(u);
    }
    function makeKey(shape,color){ return `${shape}:${color}`; }

    function makeShapeEl(shape, colorName){
      const color = COLORS[colorName];
      const wrap = document.createElement("div");
      wrap.className = "shape-wrap";
      wrap.setAttribute("aria-label", `${colorName} ${shape}`);
      wrap.style.setProperty("--shape-color", color);

      const inner = document.createElement("div");
      inner.className = shape; // circle | square | heart (CSS shapes)
      wrap.appendChild(inner);
      return wrap;
    }

    function renderChoice(shape, color){
      const box = document.createElement("button");
      box.className = "choice";
      box.type = "button";
      box.dataset.key = makeKey(shape,color);
      box.appendChild(makeShapeEl(shape,color));
      box.addEventListener("click", () => checkAnswer(box.dataset.key, box));
      return box;
    }

    // ---------- Rounds ----------
    function newRound(){
      elGrid.innerHTML = "";
      elPattern.innerHTML = "";

      // Randomly choose a mode: 'match' (question + 9 choices) or 'pattern' (show 2, pick 3rd)
      const mode = Math.random() < 0.5 ? "match" : "pattern";

      if(mode === "match"){
        const shape = rand(SHAPES);
        const color = rand(COLOR_NAMES);
        correctKey = makeKey(shape,color);
        currentQuestion = `Pick the ${color} ${shape}.`;
        elQ.textContent = currentQuestion;

        // Correct + 8 distractors (unique)
        const allCombos = [];
        for(const s of SHAPES){ for(const c of COLOR_NAMES){ allCombos.push([s,c]); } }
        const options = new Set([JSON.stringify([shape,color])]);
        while(options.size < 9){
          const pick = rand(allCombos);
          options.add(JSON.stringify(pick));
        }
        const choiceList = shuffle([...options].map(JSON.parse));

        choiceList.forEach(([s,c]) => elGrid.appendChild(renderChoice(s,c)));
        speak(currentQuestion);

      } else { // pattern mode
        const shape = rand(SHAPES);
        // pick a start that allows +2 within the array
        const start = Math.floor(Math.random() * (COLOR_NAMES.length - 2));
        const c1 = COLOR_NAMES[start], c2 = COLOR_NAMES[start+1], c3 = COLOR_NAMES[start+2];
        correctKey = makeKey(shape, c3);
        currentQuestion = `What comes next in the pattern?`;
        elQ.textContent = currentQuestion;

        // Show pattern: two colored shapes + "?"
        [c1, c2].forEach(c=>{
          const holder = document.createElement("div");
          holder.appendChild(makeShapeEl(shape,c));
          elPattern.appendChild(holder);
        });
        const qm = document.createElement("div");
        qm.className = "qmark";
        qm.textContent = "?";
        elPattern.appendChild(qm);

        // Build options: correct + 5 random distractors (avoid duplicates)
        const pool = [];
        for(const c of COLOR_NAMES) pool.push([shape,c]);
        const set = new Set([JSON.stringify([shape,c3])]);
        while(set.size < 6){
          const pick = rand(pool);
          set.add(JSON.stringify(pick));
        }
        const opts = shuffle([...set].map(JSON.parse));
        opts.forEach(([s,c]) => elGrid.appendChild(renderChoice(s,c)));

        speak(currentQuestion);
      }
    }

    // ---------- Answer logic ----------
    function checkAnswer(key, el){
      if(key === correctKey){
        el.classList.add("correct");
        try{ sndOK.currentTime = 0; sndOK.play(); }catch{}
        speak("Correct!");
        // brief pause then next round
        setTimeout(newRound, 650);
      } else {
        el.classList.add("wrong");
        setTimeout(()=>el.classList.remove("wrong"), 300);
        try{ sndBuzz.currentTime = 0; sndBuzz.play(); }catch{}
        speak("Try again");
      }
    }

    // Start
    newRound();
  </script>
</body>
</html>

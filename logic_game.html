<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Logic Quest</title>
<style>
body {
  font-family: Arial, sans-serif;
  background: #f7f7f7;
  display: flex; justify-content: center; align-items: center;
  height: 100vh; margin: 0;
}
.game-container {
  background: #fff; padding: 20px; border-radius: 15px;
  box-shadow: 0 4px 10px rgba(0,0,0,0.2);
  text-align: center; width: 90%; max-width: 600px;
}
h1 { color: #2c3e50; }
#question { font-size: 1.3rem; margin: 15px 0; }
#pattern-display { display: flex; justify-content: center; margin: 15px 0; }
.item { font-size: 2.5rem; margin: 0 5px; }
#answer-grid { display: grid; grid-template-columns: repeat(3,1fr); gap: 10px; margin: 20px 0; }
.answer-box {
  font-size: 2rem; padding: 15px; background: #ecf0f1;
  border: 2px solid #ccc; border-radius: 10px; cursor: pointer;
}
.answer-box:hover { background: #dfe6e9; }
.drag-drop-container { display: flex; justify-content: center; gap: 15px; margin: 20px 0; }
.drag-item {
  font-size: 2rem; padding: 10px; border: 2px solid #ccc;
  border-radius: 10px; cursor: grab; background: #ecf0f1;
}
.drop-zone {
  width: 80px; height: 80px; border: 2px dashed #999;
  border-radius: 10px; display: flex; align-items: center; justify-content: center;
}
#message { font-weight: bold; margin: 10px 0; }
#score { margin-top: 10px; }
</style>
</head>
<body>
<div class="game-container">
  <h1>Logic Quest</h1>
  <div id="question"></div>
  <div id="pattern-display"></div>
  <div id="answer-grid"></div>
  <div id="drag-drop-container" class="drag-drop-container" style="display:none;"></div>
  <div id="message"></div>
  <div id="score">Score: 0</div>
</div>

<audio id="success-sound" src="https://actions.google.com/sounds/v1/cartoon/wood_plank_flicks.ogg" preload="auto"></audio>
<audio id="buzz-sound" src="https://actions.google.com/sounds/v1/alarms/beep_short.ogg" preload="auto"></audio>

<script>
const colors = ['red','blue','green','yellow','purple','orange','black','brown'];
const shapes = ['circle','square','heart'];

const coloredEmojis = {
  circle: ['üî¥','üîµ','üü¢','üü°','üü£','üü†','‚ö´','üü§'],
  square: ['üü•','üü¶','üü©','üü®','üü™','üüß','‚¨õ','üü´'],
  heart:  ['‚ù§Ô∏è','üíô','üíö','üíõ','üíú','üß°','üñ§','ü§é']
};
const uniqueEmojis = {
  'happy face':'üòÄ','sad face':'üò©','laughing face':'üòÇ','angry face':'üò†',
  'celebrating face':'ü•≥','shocked face':'ü§Ø','winking face':'üòâ','sleeping face':'üò¥',
  'cold face':'ü•∂','light bulb':'üí°','bell':'üîî'
};

let score=0, correctAnswer='';

const questionEl=document.getElementById('question');
const patternDisplay=document.getElementById('pattern-display');
const answerGrid=document.getElementById('answer-grid');
const dragDropContainer=document.getElementById('drag-drop-container');
const messageDisplay=document.getElementById('message');
const scoreDisplay=document.getElementById('score');
const successSound=document.getElementById('success-sound');
const buzzSound=document.getElementById('buzz-sound');

function newRound(){
  messageDisplay.textContent='';
  patternDisplay.innerHTML='';
  answerGrid.innerHTML='';
  dragDropContainer.style.display='none';
  const types=['find-different','find-emoji','pattern','drag-drop'];
  const type=types[Math.floor(Math.random()*types.length)];
  if(type==='find-different') setupFindDifferent();
  if(type==='find-emoji') setupFindEmoji();
  if(type==='pattern') setupPattern();
  if(type==='drag-drop') setupDragDrop();
}

function setupFindDifferent(){
  const pool=[...Object.values(coloredEmojis).flat(),...Object.values(uniqueEmojis)];
  const common=pool[Math.floor(Math.random()*pool.length)];
  let diff; do{diff=pool[Math.floor(Math.random()*pool.length)];}while(diff===common);
  const options=Array(8).fill(common);
  options.splice(Math.floor(Math.random()*9),0,diff);
  correctAnswer=diff;
  renderGrid(options);
  questionEl.textContent="Find the one that is different.";
}

function setupFindEmoji(){
  const pool=[...Object.values(coloredEmojis).flat(),...Object.values(uniqueEmojis)];
  const target=pool[Math.floor(Math.random()*pool.length)];
  correctAnswer=target;

  // Build clue
  let clue="";
  for(const [k,v] of Object.entries(uniqueEmojis)){
    if(v===target){ clue=`Find the ${k}.`; }
  }
  if(!clue){
    for(const s in coloredEmojis){
      const idx=coloredEmojis[s].indexOf(target);
      if(idx>-1) clue=`Find the ${colors[idx]} ${s}.`;
    }
  }
  questionEl.textContent=clue;

  // Options
  const opts=[target];
  while(opts.length<9){
    let c=pool[Math.floor(Math.random()*pool.length)];
    if(!opts.includes(c)) opts.push(c);
  }
  renderGrid(opts);
}

function setupPattern(){
  const shape=shapes[Math.floor(Math.random()*shapes.length)];
  const start=Math.floor(Math.random()*(colors.length-2));
  const seq=[coloredEmojis[shape][start],coloredEmojis[shape][start+1],coloredEmojis[shape][start+2]];
  patternDisplay.innerHTML=`<div class="item">${seq[0]}</div><div class="item">${seq[1]}</div><div class="item">?</div>`;
  correctAnswer=seq[2];
  const opts=generateOptions(correctAnswer,4,[...Object.values(coloredEmojis).flat()]);
  renderGrid(opts);
  questionEl.textContent="Complete the pattern.";
}

function setupDragDrop(){
  dragDropContainer.innerHTML="";
  dragDropContainer.style.display='flex';
  const shape=shapes[Math.floor(Math.random()*shapes.length)];
  const color=colors[Math.floor(Math.random()*colors.length)];
  const target=coloredEmojis[shape][colors.indexOf(color)];
  correctAnswer=target;
  questionEl.textContent=`Drag the ${color} ${shape}.`;

  const distractors=generateOptions(target,3,[...Object.values(coloredEmojis).flat()]);
  shuffleArray(distractors);
  distractors.forEach(e=>{
    const item=document.createElement('div');
    item.textContent=e; item.className="drag-item"; item.draggable=true;
    item.addEventListener('dragstart',ev=>ev.dataTransfer.setData('text/plain',e));
    dragDropContainer.appendChild(item);
  });
  const drop=document.createElement('div'); drop.className="drop-zone";
  drop.addEventListener('dragover',e=>e.preventDefault());
  drop.addEventListener('drop',e=>{e.preventDefault(); checkAnswer(e.dataTransfer.getData('text/plain'));});
  dragDropContainer.appendChild(drop);
}

function renderGrid(options){
  shuffleArray(options);
  options.forEach(e=>{
    const box=document.createElement('div'); box.className='answer-box'; box.textContent=e;
    box.onclick=()=>checkAnswer(e); answerGrid.appendChild(box);
  });
}

function checkAnswer(choice){
  if(choice===correctAnswer){
    successSound.play();
    score++;
    scoreDisplay.textContent=`Score: ${score}`;
    messageDisplay.textContent="‚úÖ Correct!";
    setTimeout(newRound,1000);
  } else {
    buzzSound.play();
    messageDisplay.textContent="‚ùå Try again!";
  }
}

function generateOptions(correct,count,pool){
  const opts=new Set([correct]);
  while(opts.size<count){ opts.add(pool[Math.floor(Math.random()*pool.length)]); }
  return [...opts];
}

function shuffleArray(arr){
  for(let i=arr.length-1;i>0;i--){
    const j=Math.floor(Math.random()*(i+1));
    [arr[i],arr[j]]=[arr[j],arr[i]];
  }
  return arr;
}

// start immediately
window.onload=newRound;
</script>
</body>
</html>

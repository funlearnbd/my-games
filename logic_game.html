<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Kids Learning Game</title>
  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background: linear-gradient(135deg, #ffecd2, #fcb69f);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 100vh;
      overflow: hidden;
    }

    .start-button {
      font-size: 3em;
      padding: 20px 40px;
      border: none;
      border-radius: 50px;
      background: gold;
      color: white;
      cursor: pointer;
      animation: glow 1.5s infinite alternate;
      box-shadow: 0 0 20px gold;
    }
    @keyframes glow {
      from { box-shadow: 0 0 20px gold; }
      to   { box-shadow: 0 0 40px orange; }
    }

    .exit-button {
      position: absolute;
      top: 15px;
      right: 15px;
      font-size: 1.5em;
      padding: 10px 20px;
      border: none;
      border-radius: 20px;
      background: crimson;
      color: white;
      cursor: pointer;
    }

    .game-container {
      display: none;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      width: 100%;
      height: 100%;
    }

    .question {
      font-size: 2.5em;
      margin-bottom: 20px;
      color: #333;
      text-align: center;
    }

    .options {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 20px;
      max-width: 90%;
    }

    .option {
      width: 150px;
      height: 150px;
      border-radius: 20px;
      background: white;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: transform 0.2s;
      box-shadow: 0 4px 10px rgba(0,0,0,0.2);
    }

    .option img {
      max-width: 90%;
      max-height: 90%;
    }

    .option:hover {
      transform: scale(1.1);
    }

    .star-effect {
      position: absolute;
      pointer-events: none;
      font-size: 2em;
      animation: starFloat 1s ease-out forwards;
    }
    @keyframes starFloat {
      from { opacity: 1; transform: translateY(0) scale(1); }
      to   { opacity: 0; transform: translateY(-50px) scale(2); }
    }

    .container-box {
      border: 4px solid #555;
      border-radius: 15px;
      padding: 15px;
      margin: 20px;
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 15px;
      background: #fff8;
    }

    .hidden-slot {
      width: 150px;
      height: 150px;
      border: 3px dashed #aaa;
      border-radius: 20px;
    }

    /* Congrats popup */
    #congratsPopup {
      display: none;
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: white;
      border-radius: 20px;
      padding: 40px;
      text-align: center;
      font-size: 2em;
      color: #333;
      box-shadow: 0 0 30px rgba(0,0,0,0.3);
      z-index: 1000;
    }

  </style>
</head>
<body>

  <button id="startBtn" class="start-button">✨ Start Game ✨</button>
  <button id="exitBtn" class="exit-button" style="display:none;">Exit</button>

  <div id="game" class="game-container">
    <div id="question" class="question"></div>
    <div id="questionBox" class="container-box"></div>
    <div id="answerBox" class="container-box"></div>
  </div>

  <div id="congratsPopup">🎉 Congratulations! 🎉<br>You reached 10 points!</div>

  <script>
    const imageList = [
      "apple","ball","banana","car","cat",
      "cherry","dog","fish","flower","orange"
    ];

    let currentMode = "";
    let lastAnswer = null;
    let score = 0;
    let waitingNextRound = false;
    let voicesReady = false;

    const startBtn = document.getElementById("startBtn");
    const exitBtn = document.getElementById("exitBtn");
    const game = document.getElementById("game");
    const qEl = document.getElementById("question");
    const qBox = document.getElementById("questionBox");
    const aBox = document.getElementById("answerBox");
    const popup = document.getElementById("congratsPopup");

    // preload
    const loadedImages = {};
    imageList.forEach(name => {
      const img = new Image();
      img.src = `image/${name}.png`;
      loadedImages[name] = img;
    });

    // Speech
    function speak(text, cb) {
      if (!voicesReady) { cb && cb(); return; }
      const utter = new SpeechSynthesisUtterance(text);
      utter.rate = 0.8;
      utter.pitch = 1.0;
      utter.onend = () => cb && cb();
      speechSynthesis.speak(utter);
    }

    // Buttons
    startBtn.onclick = () => {
      voicesReady = true;
      if (speechSynthesis.getVoices().length === 0) {
        speechSynthesis.onvoiceschanged = () => voicesReady = true;
      }
      startBtn.style.display = "none";
      exitBtn.style.display = "block";
      game.style.display = "flex";
      nextRound();
    };

    exitBtn.onclick = () => { window.location.href = "index.html"; };

    // Game control
    function nextRound(){
      if(waitingNextRound) return;
      qBox.innerHTML = "";
      aBox.innerHTML = "";
      qBox.style.display = "none";
      aBox.style.display = "none";

      const modes = ["find","different","missing","memory","shadow"];
      currentMode = modes[Math.floor(Math.random()*modes.length)];

      if(currentMode==="find") startFindRound();
      else if(currentMode==="different") startDifferentRound();
      else if(currentMode==="missing") startMissingRound();
      else if(currentMode==="memory") startMemoryRound();
      else if(currentMode==="shadow") startShadowRound();
    }

    // Game Rounds
    function startFindRound(){
      const choices = shuffle([...imageList]).slice(0,4);
      const target = choices[Math.floor(Math.random()*choices.length)];
      lastAnswer = target;
      qEl.textContent = `Find the ${target}`;
      speak(`Can you find the ${target}?`);
      aBox.style.display = "flex";
      choices.forEach(n => makeAnswerTile(n, n===target));
    }

    function startDifferentRound(){
      const base = imageList[Math.floor(Math.random()*imageList.length)];
      let odd;
      do { odd = imageList[Math.floor(Math.random()*imageList.length)]; }
      while(odd===base);
      const options = shuffle([base,base,base,odd]);
      qEl.textContent = "Find the different one!";
      speak("Which one is different?");
      aBox.style.display = "flex";
      options.forEach(n => makeAnswerTile(n, n===odd));
    }

    function startMissingRound(){
      const all = shuffle([...imageList]).slice(0,6);
      const missing = all.pop();
      qEl.textContent = "Which one is missing?";
      speak("Which picture is missing?");
      qBox.style.display = "flex";
      aBox.style.display = "flex";
      // Show question set with one blank
      all.forEach(n => qBox.appendChild(makeTile(n)));
      const blank = document.createElement("div");
      blank.className = "hidden-slot";
      qBox.appendChild(blank);
      // Answers
      const wrong = all[0];
      const distractor = imageList.find(x => !all.includes(x) && x!==missing);
      const answers = shuffle([missing, wrong, distractor]);
      answers.forEach(n => makeAnswerTile(n, n===missing, blank));
    }

    function startMemoryRound(){
      const pair = shuffle([...imageList]).slice(0,2);
      const options = shuffle([...pair, ...pair]);
      qEl.textContent = "Match the pairs!";
      speak("Can you match the pairs?");
      aBox.style.display = "flex";
      // simple demo: just ask to click correct
      options.forEach(n => makeAnswerTile(n, true));
    }

    function startShadowRound(){
      const obj = imageList[Math.floor(Math.random()*imageList.length)];
      let fake;
      do { fake = imageList[Math.floor(Math.random()*imageList.length)]; } while(fake===obj);
      qEl.textContent = "Find the shadow!";
      speak("Can you find the shadow?");
      aBox.style.display = "flex";
      makeAnswerTile(obj,true);
      makeAnswerTile(fake,false);
    }

    // Helpers
    function makeTile(name){
      const div = document.createElement("div");
      div.className = "option";
      const img = document.createElement("img");
      img.src = loadedImages[name].src;
      div.appendChild(img);
      return div;
    }

    function makeAnswerTile(name, correct, blank=null){
      const div = document.createElement("div");
      div.className = "option";
      const img = document.createElement("img");
      img.src = loadedImages[name].src;
      div.appendChild(img);
      div.onclick = ()=>{
        if(waitingNextRound) return;
        if(correct){
          addStars(div);
          score++;
          if(blank){
            blank.innerHTML = "";
            const fill = document.createElement("img");
            fill.src = loadedImages[name].src;
            fill.style.animation = "glow 1s infinite alternate";
            blank.appendChild(fill);
          }
          if(score%10===0){
            waitingNextRound = true;
            popup.style.display="block";
            speak(`Congratulations, you have got ${score} points!`,()=>{
              popup.style.display="none";
              waitingNextRound = false;
              nextRound();
            });
          }else{
            waitingNextRound = true;
            setTimeout(()=>{waitingNextRound=false;nextRound();},1500);
          }
        }else{
          speak("Try again");
        }
      };
      aBox.appendChild(div);
      return div;
    }

    function shuffle(arr){ return arr.sort(()=>Math.random()-0.5); }

    function addStars(target){
      for(let i=0;i<8;i++){
        const star=document.createElement("div");
        star.className="star-effect";
        star.textContent="⭐";
        const rect=target.getBoundingClientRect();
        star.style.left=rect.left+rect.width/2+"px";
        star.style.top=rect.top+rect.height/2+"px";
        document.body.appendChild(star);
        setTimeout(()=>star.remove(),1000);
      }
    }
  </script>
</body>
</html>

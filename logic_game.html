<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Kids Logic Game</title>
<style>
  body {
    font-family: Arial, sans-serif;
    text-align: center;
    background: #f8fbff;
    margin: 0;
    padding: 20px;
  }
  h1 { margin-top: 10px; font-size: 32px; color: #2c3e50; }
  #question { font-size: 24px; margin: 20px 0; color: #34495e; min-height: 40px; }
  #grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(100px, 1fr)); gap: 15px; justify-content: center; margin: 20px auto; max-width: 500px; }
  .answer-box { width: 100px; height: 100px; display: flex; align-items: center; justify-content: center; font-size: 48px; border: 2px solid #3498db; border-radius: 16px; background: white; cursor: pointer; user-select: none; transition: transform 0.2s; }
  .answer-box:hover { transform: scale(1.1); }
  #drop-zone { margin: 20px auto; width: 220px; height: 120px; border: 2px dashed #27ae60; display: flex; align-items: center; justify-content: center; font-size: 18px; border-radius: 12px; color: #666; display: none; }
  #message { font-size: 22px; margin-top: 10px; height: 28px; }
  #score { font-size: 20px; margin-top: 5px; color: #2c3e50; }
  #puzzle-display { display: grid; grid-template-columns: repeat(2, 80px); justify-content: center; gap: 10px; margin-bottom: 15px; font-size: 48px; }
</style>
</head>
<body>
<h1>Kids Logic Game</h1>
<div id="question">Loading...</div>
<div id="puzzle-display"></div>
<div id="grid"></div>
<div id="drop-zone">Drag & Drop Answer Here</div>
<div id="message"></div>
<div id="score">Score: 0</div>

<audio id="success-sound" src="https://actions.google.com/sounds/v1/cartoon/clang_and_wobble.ogg"></audio>
<audio id="buzz-sound" src="https://actions.google.com/sounds/v1/alarms/beep_short.ogg"></audio>

<script>
const synth = window.speechSynthesis;
const questionDisplay = document.getElementById("question");
const grid = document.getElementById("grid");
const dropZone = document.getElementById("drop-zone");
const messageDisplay = document.getElementById("message");
const puzzleDisplay = document.getElementById("puzzle-display");
const scoreDisplay = document.getElementById("score");
const successSound = document.getElementById("success-sound");
const buzzSound = document.getElementById("buzz-sound");

let score = 0;
let totalRounds = 0;
let selectRounds = 0;
let dragRounds = 0;
let missingRounds = 0;
let diffRounds = 0;
let correctAnswer = {};
let currentMode = "select";

const items = [
  {emoji:"🍎", name:"apple"}, {emoji:"🍊", name:"orange"}, {emoji:"🍋", name:"lemon"}, {emoji:"🍏", name:"green apple"},
  {emoji:"🍇", name:"grapes"}, {emoji:"🍓", name:"strawberry"}, {emoji:"🍒", name:"cherry"}, {emoji:"🍉", name:"watermelon"},
  {emoji:"🥭", name:"mango"}, {emoji:"🍍", name:"pineapple"}, {emoji:"😀", name:"happy face"}, {emoji:"😂", name:"laughing face"},
  {emoji:"🥳", name:"celebrating face"}, {emoji:"😍", name:"loving face"}, {emoji:"😎", name:"cool face"}, {emoji:"🤩", name:"star-struck face"},
  {emoji:"🐶", name:"dog"}, {emoji:"🐱", name:"cat"}, {emoji:"🦄", name:"unicorn"}, {emoji:"🐼", name:"panda"}
];

function speak(text){
  if(!synth) return;
  const utter = new SpeechSynthesisUtterance(text);
  utter.lang = "en-US";
  utter.rate = 1;
  synth.speak(utter);
}

function shuffleArray(arr){
  for(let i=arr.length-1;i>0;i--){
    const j=Math.floor(Math.random()*(i+1));
    [arr[i],arr[j]]=[arr[j],arr[i]];
  }
}

function newRound(){
  messageDisplay.textContent = "";
  dropZone.style.display="none";
  grid.innerHTML="";
  puzzleDisplay.innerHTML="";
  totalRounds++;

  // Determine mode based on progress
  if(selectRounds<10){ currentMode="select"; selectRounds++; }
  else if(dragRounds<10){ currentMode="drag"; dragRounds++; }
  else if(missingRounds<10){ currentMode="missing"; missingRounds++; }
  else if(diffRounds<10){ currentMode="different"; diffRounds++; }
  else{ // Random mode after structured rounds
    const modes=["select","drag","missing","different"];
    currentMode=modes[Math.floor(Math.random()*modes.length)];
  }

  if(currentMode==="select" || currentMode==="drag"){
    let availableItems = items.slice();
    shuffleArray(availableItems);
    correctAnswer = availableItems[Math.floor(Math.random()*availableItems.length)];
    questionDisplay.textContent = (currentMode==="select"?"Find the ":"Drag the ") + correctAnswer.name;
    speak(questionDisplay.textContent);
    if(currentMode==="drag") dropZone.style.display="flex";

    const options = availableItems.slice(0,6);
    if(!options.includes(correctAnswer)) options[0]=correctAnswer;
    shuffleArray(options);

    options.forEach(opt=>{
      const box=document.createElement("div");
      box.className="answer-box";
      box.textContent=opt.emoji;
      box.draggable = currentMode==="drag";
      if(currentMode==="select") box.onclick = ()=>checkAnswer(opt.emoji);
      box.addEventListener("dragstart", e=>{
        if(currentMode==="drag") e.dataTransfer.setData("text/plain", opt.emoji);
      });
      grid.appendChild(box);
    });
  }

  else if(currentMode==="different"){
    const base = items[Math.floor(Math.random()*items.length)];
    const different = items.filter(it=>it!==base)[Math.floor(Math.random()*items.length)];
    correctAnswer = different;
    questionDisplay.textContent="Find the different one!";
    speak(questionDisplay.textContent);
    const arr = Array(5).fill(base).concat(different);
    shuffleArray(arr);
    arr.forEach(opt=>{
      const box=document.createElement("div");
      box.className="answer-box";
      box.textContent=opt.emoji;
      box.onclick = ()=>checkAnswer(opt.emoji);
      grid.appendChild(box);
    });
  }

  else if(currentMode==="missing"){
    let availableItems = items.slice();
    shuffleArray(availableItems);
    const sequence = availableItems.slice(0,4); // 2x2 grid
    const missingIndex = Math.floor(Math.random()*sequence.length);
    correctAnswer = sequence[missingIndex];
    const puzzleArr = sequence.map((it,i)=> i===missingIndex?"❓":it.emoji);
    puzzleDisplay.innerHTML="";
    puzzleArr.forEach(e=>{
      const div=document.createElement("div");
      div.textContent=e;
      puzzleDisplay.appendChild(div);
    });
    questionDisplay.textContent="Find the missing piece!";
    speak(questionDisplay.textContent);

    const wrongs = availableItems.filter(it=>it!==correctAnswer).slice(0,2);
    const options = [correctAnswer,...wrongs];
    shuffleArray(options);
    options.forEach(opt=>{
      const box=document.createElement("div");
      box.className="answer-box";
      box.textContent=opt.emoji;
      box.onclick = ()=>checkAnswer(opt.emoji);
      grid.appendChild(box);
    });
  }
}

function checkAnswer(choice){
  if(choice===correctAnswer.emoji){
    successSound.play();
    score++;
    scoreDisplay.textContent="Score: "+score;
    messageDisplay.textContent="✅ Correct!";
    setTimeout(newRound,1000);
  }else{
    buzzSound.play();
    messageDisplay.textContent="❌ Try again!";
  }
}

dropZone.addEventListener("dragover", e=>e.preventDefault());
dropZone.addEventListener("drop", e=>{
  e.preventDefault();
  checkAnswer(e.dataTransfer.getData("text/plain"));
});

newRound();
</script>
</body>
</html>

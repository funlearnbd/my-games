<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Kids Logic Game</title>
<style>
body {
  font-family: 'Comic Sans MS', cursive, sans-serif;
  text-align: center;
  background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%);
  margin: 0;
  padding: 20px;
  min-height: 100vh;
  position: relative;
}
h1 { 
  margin-top: 10px; 
  font-size: 42px; 
  color: #e74c3c; 
  text-shadow: 2px 2px #fff;
}
#question { 
  font-size: 28px; 
  margin: 20px 0; 
  color: #2c3e50; 
  min-height: 50px; 
}
#grid { 
  display: grid; 
  grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); 
  gap: 15px; 
  justify-content: center; 
  margin: 20px auto; 
  max-width: 640px; 
}
.answer-box { 
  width: 140px; 
  height: 140px; 
  display: flex; 
  align-items: center; 
  justify-content: center; 
  font-size: 60px; 
  border: 3px solid #3498db; 
  border-radius: 20px; 
  background: #fff; 
  cursor: pointer; 
  user-select: none; 
  transition: transform 0.3s, background 0.3s, border-color 0.3s;
  box-shadow: 2px 4px 12px rgba(0,0,0,0.2);
  position: relative;
}
.answer-box:hover { 
  transform: scale(1.15) rotate(-3deg); 
  border-color: #e67e22; 
  background: #fef3e2;
}
.answer-box img { width: 120px; height: 120px; object-fit: contain; }
#drop-zone { 
  margin: 20px auto; 
  width: 260px; 
  height: 140px; 
  border: 3px dashed #27ae60; 
  display: flex; 
  align-items: center; 
  justify-content: center; 
  font-size: 20px; 
  border-radius: 16px; 
  color: #27ae60; 
  display: none; 
  transition: background 0.3s, border-color 0.3s;
  background: #d4f7dc;
  position: relative;
}
#drop-zone.drag-over { background: #a4e0b0; border-color: #2ecc71; color:#2c3e50; }
#message { font-size: 26px; margin-top: 10px; height: 30px; font-weight: bold; color:#2c3e50; }
#score { font-size: 24px; margin-top: 5px; color: #34495e; font-weight: bold; }
#puzzle-display { display: grid; grid-template-columns: repeat(2, 140px); justify-content: center; gap: 10px; margin-bottom: 15px; font-size: 60px; }
#drag-tutorial {
  display:none;
  position:absolute;
  width:80px;
  height:80px;
  pointer-events:none;
  font-size:48px;
  z-index:1000;
}
#hint-overlay {
  display:none;
  position:absolute;
  width:140px;
  height:140px;
  border: 4px solid #f1c40f;
  border-radius: 20px;
  box-shadow: 0 0 20px #f1c40f;
  z-index:999;
  pointer-events:none;
}
</style>
</head>
<body>

<h1>Kids Logic Game</h1>
<div id="question">Loading...</div>
<div id="puzzle-display"></div>
<div id="grid"></div>
<div id="drop-zone">Drag & Drop Answer Here</div>
<div id="message"></div>
<div id="score">Score: 0</div>
<div id="drag-tutorial">➡️</div>
<div id="hint-overlay"></div>

<audio id="bg-music" src="https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3" loop></audio>
<audio id="success-sound" src="https://actions.google.com/sounds/v1/cartoon/clang_and_wobble.ogg"></audio>
<audio id="buzz-sound" src="https://actions.google.com/sounds/v1/alarms/beep_short.ogg"></audio>

<script>
const synth = window.speechSynthesis;
const questionDisplay = document.getElementById("question");
const grid = document.getElementById("grid");
const dropZone = document.getElementById("drop-zone");
const messageDisplay = document.getElementById("message");
const puzzleDisplay = document.getElementById("puzzle-display");
const scoreDisplay = document.getElementById("score");
const dragTutorial = document.getElementById("drag-tutorial");
const hintOverlay = document.getElementById("hint-overlay");
const bgMusic = document.getElementById("bg-music");
bgMusic.volume = 0.3;
bgMusic.play();

let score = 0;
let totalRounds = 0;
let selectRounds = 0;
let dragRounds = 0;
let missingRounds = 0;
let diffRounds = 0;
let correctAnswer = "";
let currentMode = "select";

const items = [
  {src:"https://twemoji.maxcdn.com/v/latest/72x72/1f34e.png", name:"apple", sound:"https://actions.google.com/sounds/v1/cartoon/clang_and_wobble.ogg"},
  {src:"https://twemoji.maxcdn.com/v/latest/72x72/1f34a.png", name:"orange", sound:"https://actions.google.com/sounds/v1/cartoon/metal_twang.ogg"},
  {src:"https://twemoji.maxcdn.com/v/latest/72x72/1f34c.png", name:"banana", sound:"https://actions.google.com/sounds/v1/cartoon/wood_plank_flicks.ogg"},
  {src:"https://twemoji.maxcdn.com/v/latest/72x72/1f347.png", name:"grapes", sound:"https://actions.google.com/sounds/v1/cartoon/wood_box_flicks.ogg"},
  {src:"https://twemoji.maxcdn.com/v/latest/72x72/1f353.png", name:"strawberry", sound:"https://actions.google.com/sounds/v1/cartoon/bell_ring.ogg"},
  {src:"https://twemoji.maxcdn.com/v/latest/72x72/1f338.png", name:"flower", sound:"https://actions.google.com/sounds/v1/cartoon/bell_ring.ogg"},
  {src:"https://twemoji.maxcdn.com/v/latest/72x72/1f436.png", name:"dog", sound:"https://actions.google.com/sounds/v1/animals/dog_bark.ogg"},
  {src:"https://twemoji.maxcdn.com/v/latest/72x72/1f431.png", name:"cat", sound:"https://actions.google.com/sounds/v1/animals/cat_meow.ogg"},
  {src:"https://twemoji.maxcdn.com/v/latest/72x72/1f43c.png", name:"panda", sound:"https://actions.google.com/sounds/v1/cartoon/clang_and_wobble.ogg"}
];

function speak(text){
  if(!synth) return;
  const utter = new SpeechSynthesisUtterance(text);
  utter.lang = "en-US";
  utter.rate = 1;
  synth.speak(utter);
}

function shuffleArray(arr){
  for(let i=arr.length-1;i>0;i--){
    const j=Math.floor(Math.random()*(i+1));
    [arr[i],arr[j]]=[arr[j],arr[i]];
  }
}

function newRound(){
  messageDisplay.textContent = "";
  dropZone.style.display="none";
  dropZone.classList.remove("drag-over");
  grid.innerHTML="";
  puzzleDisplay.innerHTML="";
  dragTutorial.style.display="none";
  hintOverlay.style.display="none";
  totalRounds++;

  if(selectRounds<10) currentMode="select";
  else if(dragRounds<10) currentMode="drag";
  else if(missingRounds<10) currentMode="missing";
  else if(diffRounds<10) currentMode="different";
  else {
    const modes=["select","drag","missing","different"];
    currentMode=modes[Math.floor(Math.random()*modes.length)];
  }

  if(currentMode==="select" || currentMode==="drag"){
    let availableItems = items.slice();
    shuffleArray(availableItems);
    const correctItem = availableItems[Math.floor(Math.random()*availableItems.length)];
    correctAnswer = correctItem.src;
    questionDisplay.textContent = (currentMode==="select"?"Find the ":"Drag the ") + correctItem.name;
    speak(questionDisplay.textContent);
    if(currentMode==="drag") dropZone.style.display="flex";

    const options = availableItems.slice(0,6);
    if(!options.map(it=>it.src).includes(correctAnswer)) options[0]=correctItem;
    shuffleArray(options);

    options.forEach(opt=>{
      const box=document.createElement("div");
      box.className="answer-box";
      const img=document.createElement("img");
      img.src=opt.src;
      box.appendChild(img);
      box.draggable = currentMode==="drag";
      if(currentMode==="select") box.onclick = ()=>checkAnswer(opt.src,opt.sound);
      box.addEventListener("dragstart", e=>{
        if(currentMode==="drag") e.dataTransfer.setData("text/plain", opt.src);
      });
      grid.appendChild(box);
    });

    if((selectRounds<2 && currentMode==="select") || (dragRounds<2 && currentMode==="drag")){
      showHint();
    }

    if(currentMode==="drag" && dragRounds<2) showDragTutorial();
  }
  else if(currentMode==="different"){
    diffRounds++;
    const base = items[Math.floor(Math.random()*items.length)];
    const different = items.filter(it=>it!==base)[Math.floor(Math.random()*items.length)];
    correctAnswer = different.src;
    questionDisplay.textContent = "Find the different item!";
    speak(questionDisplay.textContent);
    const options = Array(5).fill(base).concat([different]);
    shuffleArray(options);
    options.forEach(opt=>{
      const box=document.createElement("div");
      box.className="answer-box";
      const img=document.createElement("img");
      img.src=opt.src;
      box.appendChild(img);
      box.onclick = ()=>checkAnswer(opt.src,opt.sound);
      grid.appendChild(box);
    });
  }
  else if(currentMode==="missing"){
    missingRounds++;
    let sequence = items.slice(0);
    shuffleArray(sequence);
    sequence=sequence.slice(0,4);
    const missingIndex = Math.floor(Math.random()*sequence.length);
    correctAnswer = sequence[missingIndex].src;
    questionDisplay.textContent="Find the missing piece!";
    speak(questionDisplay.textContent);

    sequence.forEach((it,i)=>{
      if(i!==missingIndex){
        const div=document.createElement("div");
        div.className="answer-box";
        const img=document.createElement("img");
        img.src=it.src;
        div.appendChild(img);
        puzzleDisplay.appendChild(div);
      }
    });

    const options = [sequence[missingIndex]];
    while(options.length<3){
      const item = items[Math.floor(Math.random()*items.length)];
      if(!options.includes(item)) options.push(item);
    }
    shuffleArray(options);

    options.forEach(opt=>{
      const box=document.createElement("div");
      box.className="answer-box";
      const img=document.createElement("img");
      img.src=opt.src;
      box.appendChild(img);
      box.onclick = ()=>checkAnswer(opt.src,opt.sound);
      grid.appendChild(box);
    });

    if(missingRounds<=2) showHint();
  }

  if(currentMode==="select") selectRounds++;
  if(currentMode==="drag") dragRounds++;
}

function checkAnswer(selected,sound){
  if(selected===correctAnswer){
    document.getElementById("success-sound").play();
    if(sound) new Audio(sound).play();
    messageDisplay.textContent="✅ Correct!";
    speak("Correct!");
    score++;
    scoreDisplay.textContent="Score: "+score;
    setTimeout(newRound,1200);
  } else {
    document.getElementById("buzz-sound").play();
    messageDisplay.textContent="❌ Try again!";
    speak("Try again!");
  }
}

function showHint(){
  const boxes = document.querySelectorAll(".answer-box");
  boxes.forEach(box=>{
    if(box.querySelector("img") && box.querySelector("img").src===correctAnswer){
      const rect = box.getBoundingClientRect();
      hintOverlay.style.top = rect.top + "px";
      hintOverlay.style.left = rect.left + "px";
      hintOverlay.style.display="block";
      setTimeout(()=>hintOverlay.style.display="none",1500);
    }
  });
}

function showDragTutorial(){
  const box = document.querySelector(".answer-box img");
  if(!box) return;
  const rect = box.getBoundingClientRect();
  dragTutorial.style.top=rect.top+"px";
  dragTutorial.style.left=rect.left+"px";
  dragTutorial.style.display="block";
  const dzRect = dropZone.getBoundingClientRect();
  let step=0;
  const interval = setInterval(()=>{
    if(step>20){ dragTutorial.style.display="none"; clearInterval(interval); return;}
    const x = rect.left + (dzRect.left-rect.left)*(step/20);
    const y = rect.top + (dzRect.top-rect.top)*(step/20);
    dragTutorial.style.left=x+"px";
    dragTutorial.style.top=y+"px";
    step++;
  },30);
}

dropZone.addEventListener("dragover", e=>e.preventDefault());
dropZone.addEventListener("drop", e=>{
  e.preventDefault();
  const src = e.dataTransfer.getData("text/plain");
  checkAnswer(src);
  dropZone.classList.remove("drag-over");
});
dropZone.addEventListener("dragenter", e=>{ dropZone.classList.add("drag-over"); });
dropZone.addEventListener("dragleave", e=>{ dropZone.classList.remove("drag-over"); });

newRound();
</script>

</body>
</html>

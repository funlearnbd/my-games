<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Kids Logic Game</title>
<style>
  body {
    font-family: Arial, sans-serif;
    text-align: center;
    background: #f8fbff;
    margin: 0;
    padding: 20px;
  }
  h1 {
    margin-top: 10px;
    font-size: 32px;
    color: #2c3e50;
  }
  #question {
    font-size: 24px;
    margin: 20px 0;
    color: #34495e;
    min-height: 40px;
  }
  #grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
    gap: 15px;
    justify-content: center;
    margin: 20px auto;
    max-width: 500px;
  }
  .answer-box {
    width: 100px;
    height: 100px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 48px;
    border: 2px solid #ccc;
    border-radius: 16px;
    background: white;
    cursor: pointer;
    user-select: none;
    transition: transform 0.2s;
  }
  .answer-box:hover {
    transform: scale(1.1);
  }
  #drop-zone {
    margin: 20px auto;
    width: 220px;
    height: 120px;
    border: 2px dashed #666;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 18px;
    border-radius: 12px;
    color: #666;
    display: none;
  }
  #message {
    font-size: 22px;
    margin-top: 10px;
    height: 28px;
  }
  #score {
    font-size: 20px;
    margin-top: 5px;
    color: #2c3e50;
  }
  #puzzle-display {
    display: flex;
    justify-content: center;
    gap: 15px;
    margin-bottom: 15px;
    font-size: 48px;
  }
</style>
</head>
<body>
<h1>Kids Logic Game</h1>
<div id="question">Loading...</div>
<div id="puzzle-display"></div>
<div id="grid"></div>
<div id="drop-zone">Drag & Drop Answer Here</div>
<div id="message"></div>
<div id="score">Score: 0</div>

<audio id="success-sound" src="https://actions.google.com/sounds/v1/cartoon/clang_and_wobble.ogg"></audio>
<audio id="buzz-sound" src="https://actions.google.com/sounds/v1/alarms/beep_short.ogg"></audio>

<script>
const synth = window.speechSynthesis;
const scoreDisplay = document.getElementById("score");
const questionDisplay = document.getElementById("question");
const grid = document.getElementById("grid");
const dropZone = document.getElementById("drop-zone");
const messageDisplay = document.getElementById("message");
const puzzleDisplay = document.getElementById("puzzle-display");
const successSound = document.getElementById("success-sound");
const buzzSound = document.getElementById("buzz-sound");

let score = 0;
let correctAnswer = {};
let currentMode = "select";

const items = [
  {emoji:"🍎", name:"apple"},
  {emoji:"🍊", name:"orange"},
  {emoji:"🍋", name:"lemon"},
  {emoji:"🍏", name:"green apple"},
  {emoji:"🍇", name:"grapes"},
  {emoji:"🍓", name:"strawberry"},
  {emoji:"🍒", name:"cherry"},
  {emoji:"🍉", name:"watermelon"},
  {emoji:"🥭", name:"mango"},
  {emoji:"🍍", name:"pineapple"},
  {emoji:"😀", name:"happy face"},
  {emoji:"😂", name:"laughing face"},
  {emoji:"🥳", name:"celebrating face"},
  {emoji:"😍", name:"loving face"},
  {emoji:"😎", name:"cool face"},
  {emoji:"🤩", name:"star-struck face"},
  {emoji:"🐶", name:"dog"},
  {emoji:"🐱", name:"cat"},
  {emoji:"🦄", name:"unicorn"},
  {emoji:"🐼", name:"panda"},
  {emoji:"⚽", name:"soccer ball"},
  {emoji:"🏀", name:"basketball"},
  {emoji:"🚗", name:"car"},
  {emoji:"✈️", name:"airplane"},
  {emoji:"🎸", name:"guitar"},
  {emoji:"🎁", name:"gift"},
  {emoji:"🍔", name:"burger"},
  {emoji:"🍕", name:"pizza"},
  {emoji:"🍰", name:"cake"},
  {emoji:"🍦", name:"ice cream"},
  {emoji:"🥪", name:"sandwich"},
  {emoji:"🌮", name:"taco"}
];

function speak(text){
  if(!synth) return;
  const utter = new SpeechSynthesisUtterance(text);
  utter.lang = "en-US";
  utter.rate = 1;
  synth.speak(utter);
}

function shuffleArray(arr){
  for(let i=arr.length-1;i>0;i--){
    const j=Math.floor(Math.random()*(i+1));
    [arr[i],arr[j]]=[arr[j],arr[i]];
  }
}

function newRound(){
  messageDisplay.textContent = "";
  dropZone.style.display = "none";
  grid.innerHTML = "";
  puzzleDisplay.innerHTML = "";

  const modes = ["select","drag","different","puzzle"];
  currentMode = modes[Math.floor(Math.random()*modes.length)];

  if(currentMode==="select" || currentMode==="drag"){
    const availableItems = score<5?items.slice(0,15):items;
    shuffleArray(availableItems);
    correctAnswer = availableItems[Math.floor(Math.random()*availableItems.length)];
    questionDisplay.textContent = "Find the " + correctAnswer.name;
    speak("Find the " + correctAnswer.name);

    const options = availableItems.slice(0,6);
    if(!options.includes(correctAnswer)) options[0]=correctAnswer;
    shuffleArray(options);

    if(currentMode==="drag") dropZone.style.display = "flex";

    options.forEach(opt=>{
      const box = document.createElement("div");
      box.className = "answer-box";
      box.textContent = opt.emoji;
      box.draggable = currentMode==="drag";
      if(currentMode==="select") box.onclick = ()=>checkAnswer(opt.emoji);

      box.addEventListener("dragstart", e=>{
        if(currentMode==="drag") e.dataTransfer.setData("text/plain",opt.emoji);
      });

      grid.appendChild(box);
    });
  }

  else if(currentMode==="different"){
    const base = items[Math.floor(Math.random()*items.length)];
    const different = items.filter(it=>it!==base)[Math.floor(Math.random()*items.length)];
    correctAnswer = different;

    questionDisplay.textContent = "Find the different one!";
    speak("Find the different one!");

    const arr = Array(5).fill(base).concat(different);
    shuffleArray(arr);

    arr.forEach(opt=>{
      const box = document.createElement("div");
      box.className = "answer-box";
      box.textContent = opt.emoji;
      box.onclick = ()=>checkAnswer(opt.emoji);
      grid.appendChild(box);
    });
  }

  else if(currentMode==="puzzle"){
    // Proper missing piece: show 2 emojis + 1 missing
    const availableItems = score<5?items.slice(0,15):items;
    shuffleArray(availableItems);
    const sequence = availableItems.slice(0,3); // 3 emojis
    correctAnswer = sequence[Math.floor(Math.random()*sequence.length)];

    const missingIndex = Math.floor(Math.random()*sequence.length);
    const puzzleDisplayArr = sequence.map((it,i)=> i===missingIndex?"❓":it.emoji);

    puzzleDisplay.innerHTML = "";
    puzzleDisplayArr.forEach(e=>{
      const div = document.createElement("div");
      div.textContent = e;
      puzzleDisplay.appendChild(div);
    });

    questionDisplay.textContent = "Find the missing piece!";
    speak("Find the missing piece!");

    const wrongs = availableItems.filter(it=>it!==correctAnswer).slice(0,2);
    const options = [correctAnswer,...wrongs];
    shuffleArray(options);

    options.forEach(opt=>{
      const box = document.createElement("div");
      box.className = "answer-box";
      box.textContent = opt.emoji;
      box.onclick = ()=>checkAnswer(opt.emoji);
      grid.appendChild(box);
    });
  }
}

function checkAnswer(choice){
  if(choice===correctAnswer.emoji){
    successSound.play();
    score++;
    scoreDisplay.textContent="Score: "+score;
    messageDisplay.textContent="✅ Correct!";
    setTimeout(newRound,1000);
  }else{
    buzzSound.play();
    messageDisplay.textContent="❌ Try again!";
  }
}

dropZone.addEventListener("dragover", e=>e.preventDefault());
dropZone.addEventListener("drop", e=>{
  e.preventDefault();
  checkAnswer(e.dataTransfer.getData("text/plain"));
});

newRound();
</script>
</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Logic Quest</title>
<style>
body {
  font-family: Arial, sans-serif;
  background: #f0f4f8;
  text-align: center;
  margin: 0;
  padding: 0;
}
h1 {
  margin: 20px 0;
}
#clue-display {
  font-size: 1.4em;
  margin: 15px 0;
}
#pattern-display {
  display: flex;
  justify-content: center;
  margin: 10px 0;
}
.item {
  font-size: 2em;
  margin: 0 5px;
}
#answer-grid {
  display: grid;
  grid-template-columns: repeat(3, 80px);
  gap: 10px;
  justify-content: center;
  margin: 20px 0;
}
.answer-box {
  font-size: 2em;
  background: #fff;
  border: 2px solid #ccc;
  border-radius: 8px;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  height: 80px;
  width: 80px;
  transition: 0.2s;
}
.answer-box:hover {
  background: #dfefff;
}
#drag-drop-container {
  margin: 20px auto;
  display: flex;
  justify-content: center;
  gap: 20px;
}
.drag-item {
  font-size: 2em;
  padding: 10px;
  border: 2px dashed #999;
  background: #fff;
  cursor: grab;
}
.drop-zone {
  width: 100px;
  height: 100px;
  border: 2px solid #000;
  display: flex;
  align-items: center;
  justify-content: center;
  background: #fafafa;
}
#message {
  font-size: 1.2em;
  margin: 10px 0;
}
#score {
  margin: 10px 0;
}
</style>
</head>
<body>
  <h1>Logic Quest</h1>
  <div id="clue-display"></div>
  <div id="pattern-display"></div>
  <div id="answer-grid"></div>
  <div id="drag-drop-container" style="display:none;"></div>
  <div id="message"></div>
  <div id="score">Score: 0</div>

  <audio id="success-sound" src="https://www.soundjay.com/button/button-3.mp3" preload="auto"></audio>
  <audio id="buzz-sound" src="https://www.soundjay.com/buttons/beep-07.mp3" preload="auto"></audio>

<script>
const colors = ['red','blue','green','yellow','purple','orange','black','brown'];
const shapes = ['circle','square','heart'];

const coloredEmojis = {
  'circle': ['üî¥','üîµ','üü¢','üü°','üü£','üü†','‚ö´','üü§'],
  'square': ['üü•','üü¶','üü©','üü®','üü™','üüß','‚¨õ','üü´'],
  'heart':  ['‚ù§Ô∏è','üíô','üíö','üíõ','üíú','üß°','üñ§','ü§é']
};
const uniqueEmojis = {
  'happy face':'üòÄ','sad face':'üò©','laughing face':'üòÇ','angry face':'üò†',
  'celebrating face':'ü•≥','shocked face':'ü§Ø','winking face':'üòâ','sleeping face':'üò¥',
  'cold face':'ü•∂','light bulb':'üí°','bell':'üîî'
};

let score = 0, correctAnswer = '';

// --- Speech helper ---
function speak(text) {
  const utterance = new SpeechSynthesisUtterance(text);
  utterance.rate = 1;
  utterance.pitch = 1;
  speechSynthesis.speak(utterance);
}

function newRound() {
  document.getElementById('message').textContent = '';
  document.getElementById('pattern-display').innerHTML = '';
  document.getElementById('answer-grid').innerHTML = '';
  document.getElementById('drag-drop-container').style.display = 'none';

  const types = ['find-item','pattern','drag-drop'];
  const type = types[Math.floor(Math.random()*types.length)];
  if(type==='find-item') setupFindItem();
  if(type==='pattern') setupPattern();
  if(type==='drag-drop') setupDragDrop();
}

function setupFindItem() {
  const pool=[...Object.values(coloredEmojis).flat(),...Object.values(uniqueEmojis)];
  const target = pool[Math.floor(Math.random()*pool.length)];
  correctAnswer = target;

  let question = "";
  for(const [k,v] of Object.entries(uniqueEmojis)){
    if(v===target) question=`Find the ${k}.`;
  }
  if(!question){
    for(const s in coloredEmojis){
      const idx = coloredEmojis[s].indexOf(target);
      if(idx>-1) question=`Find the ${colors[idx]} ${s}.`;
    }
  }
  document.getElementById('clue-display').textContent = question;
  speak(question);

  const opts=[target];
  while(opts.length<9){
    let c = pool[Math.floor(Math.random()*pool.length)];
    if(!opts.includes(c)) opts.push(c);
  }
  renderGrid(opts);
}

function setupPattern() {
  const shape=shapes[Math.floor(Math.random()*shapes.length)];
  const start=Math.floor(Math.random()*(colors.length-2));
  const seq=[coloredEmojis[shape][start],coloredEmojis[shape][start+1],coloredEmojis[shape][start+2]];
  document.getElementById('pattern-display').innerHTML =
    `<div class="item">${seq[0]}</div><div class="item">${seq[1]}</div><div class="item">?</div>`;
  correctAnswer = seq[2];
  const opts = generateOptions(correctAnswer,4,[...Object.values(coloredEmojis).flat()]);
  renderGrid(opts);
  const q = "Complete the pattern.";
  document.getElementById('clue-display').textContent = q;
  speak(q);
}

function setupDragDrop() {
  const cont=document.getElementById('drag-drop-container');
  cont.innerHTML=""; cont.style.display='flex';
  const shape=shapes[Math.floor(Math.random()*shapes.length)];
  const color=colors[Math.floor(Math.random()*colors.length)];
  const target=coloredEmojis[shape][colors.indexOf(color)];
  correctAnswer=target;
  const q=`Drag the ${color} ${shape}.`;
  document.getElementById('clue-display').textContent=q;
  speak(q);

  const distractors=generateOptions(target,3,[...Object.values(coloredEmojis).flat()]);
  shuffleArray(distractors);
  distractors.forEach(e=>{
    const item=document.createElement('div');
    item.textContent=e; item.className="drag-item"; item.draggable=true;
    item.addEventListener('dragstart',ev=>ev.dataTransfer.setData('text/plain',e));
    cont.appendChild(item);
  });
  const drop=document.createElement('div');
  drop.className="drop-zone";
  drop.addEventListener('dragover',e=>e.preventDefault());
  drop.addEventListener('drop',e=>{
    e.preventDefault(); checkAnswer(e.dataTransfer.getData('text/plain'));
  });
  cont.appendChild(drop);
}

function renderGrid(options){
  shuffleArray(options);
  options.forEach(e=>{
    const box=document.createElement('div');
    box.className='answer-box'; box.textContent=e;
    box.onclick=()=>checkAnswer(e);
    document.getElementById('answer-grid').appendChild(box);
  });
}

function checkAnswer(choice){
  if(choice===correctAnswer){
    document.getElementById('success-sound').play();
    score++;
    document.getElementById('score').textContent=`Score: ${score}`;
    document.getElementById('message').textContent="‚úÖ Correct!";
    const praise=["Great job!","Well done!","You got it!"];
    speak(praise[Math.floor(Math.random()*praise.length)]);
    setTimeout(newRound,1200);
  } else {
    document.getElementById('buzz-sound').play();
    document.getElementById('message').textContent="‚ùå Try again!";
    speak("Try again!");
  }
}

function generateOptions(correct,count,pool){
  const opts=new Set([correct]);
  while(opts.size<count){
    opts.add(pool[Math.floor(Math.random()*pool.length)]);
  }
  return [...opts];
}
function shuffleArray(arr){
  for(let i=arr.length-1;i>0;i--){
    const j=Math.floor(Math.random()*(i+1));
    [arr[i],arr[j]]=[arr[j],arr[i]];
  }
  return arr;
}

window.onload=newRound;
</script>
</body>
</html>

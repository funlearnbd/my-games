<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Emoji Quest</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      text-align: center;
      background: #f8fbff;
      margin: 0;
      padding: 20px;
    }
    h1 {
      margin-top: 10px;
      font-size: 32px;
      color: #2c3e50;
    }
    #question {
      font-size: 24px;
      margin: 20px 0;
      color: #34495e;
      min-height: 40px;
    }
    #grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
      gap: 15px;
      justify-content: center;
      margin: 20px auto;
      max-width: 500px;
    }
    .answer-box {
      width: 100px;
      height: 100px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 48px;
      border: 2px solid #ccc;
      border-radius: 16px;
      background: white;
      cursor: pointer;
      user-select: none;
      transition: transform 0.2s;
    }
    .answer-box:hover {
      transform: scale(1.1);
    }
    #drop-zone {
      margin: 20px auto;
      width: 220px;
      height: 120px;
      border: 2px dashed #666;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 18px;
      border-radius: 12px;
      color: #666;
      display: none; /* hidden for select mode */
    }
    #message {
      font-size: 22px;
      margin-top: 10px;
      height: 28px;
    }
    #score {
      font-size: 20px;
      margin-top: 5px;
      color: #2c3e50;
    }
  </style>
</head>
<body>
  <h1>Emoji Quest</h1>
  <div id="question">Loading...</div>
  <div id="grid"></div>
  <div id="drop-zone">Drag & Drop Answer Here</div>
  <div id="message"></div>
  <div id="score">Score: 0</div>

  <audio id="success-sound" src="https://actions.google.com/sounds/v1/cartoon/clang_and_wobble.ogg"></audio>
  <audio id="buzz-sound" src="https://actions.google.com/sounds/v1/alarms/beep_short.ogg"></audio>

  <script>
    const levels = [
      {
        name: "Fruit Quest",
        items: [
          {emoji:"ðŸŽ", name:"apple"},
          {emoji:"ðŸŠ", name:"orange"},
          {emoji:"ðŸ‹", name:"lemon"},
          {emoji:"ðŸ", name:"green apple"},
          {emoji:"ðŸ‡", name:"grapes"},
          {emoji:"ðŸ“", name:"strawberry"},
          {emoji:"ðŸ’", name:"cherry"},
          {emoji:"ðŸ‰", name:"watermelon"},
          {emoji:"ðŸ¥­", name:"mango"},
          {emoji:"ðŸ", name:"pineapple"}
        ]
      },
      {
        name: "Emoji Faces",
        items: [
          {emoji:"ðŸ˜€", name:"happy face"},
          {emoji:"ðŸ˜‚", name:"laughing face"},
          {emoji:"ðŸ¥³", name:"celebrating face"},
          {emoji:"ðŸ˜", name:"loving face"},
          {emoji:"ðŸ˜Ž", name:"cool face"},
          {emoji:"ðŸ¤©", name:"star-struck face"},
          {emoji:"ðŸ˜´", name:"sleeping face"},
          {emoji:"ðŸ˜¡", name:"angry face"}
        ]
      },
      {
        name: "Animal Quest",
        items: [
          {emoji:"ðŸ¶", name:"dog"},
          {emoji:"ðŸ±", name:"cat"},
          {emoji:"ðŸ¦„", name:"unicorn"},
          {emoji:"ðŸ¼", name:"panda"},
          {emoji:"ðŸ§", name:"penguin"},
          {emoji:"ðŸ¸", name:"frog"}
        ]
      },
      {
        name: "Object Quest",
        items: [
          {emoji:"âš½", name:"soccer ball"},
          {emoji:"ðŸ€", name:"basketball"},
          {emoji:"ðŸš—", name:"car"},
          {emoji:"âœˆï¸", name:"airplane"},
          {emoji:"ðŸŽ¸", name:"guitar"},
          {emoji:"ðŸŽ", name:"gift"}
        ]
      },
      {
        name: "Food Quest",
        items: [
          {emoji:"ðŸ”", name:"burger"},
          {emoji:"ðŸ•", name:"pizza"},
          {emoji:"ðŸ°", name:"cake"},
          {emoji:"ðŸ¦", name:"ice cream"},
          {emoji:"ðŸ¥ª", name:"sandwich"},
          {emoji:"ðŸŒ®", name:"taco"}
        ]
      }
    ];

    let correctAnswer = {};
    let score = 0;
    const questionDisplay = document.getElementById("question");
    const grid = document.getElementById("grid");
    const dropZone = document.getElementById("drop-zone");
    const messageDisplay = document.getElementById("message");
    const scoreDisplay = document.getElementById("score");

    const successSound = document.getElementById("success-sound");
    const buzzSound = document.getElementById("buzz-sound");

    const synth = window.speechSynthesis;

    function speak(text) {
      if (!synth) return;
      const utter = new SpeechSynthesisUtterance(text);
      utter.lang = "en-US";
      utter.rate = 1;
      synth.speak(utter);
    }

    function shuffleArray(arr) {
      for (let i = arr.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [arr[i], arr[j]] = [arr[j], arr[i]];
      }
    }

    function newRound() {
      messageDisplay.textContent = "";

      // Choose level based on score (progressive difficulty)
      let availableLevels;
      if(score < 5) availableLevels = levels.map(l=>({...l, items:l.items.slice(0,6)}));
      else if(score < 10) availableLevels = levels.map(l=>({...l, items:l.items.slice(0,8)}));
      else availableLevels = levels;

      const level = availableLevels[Math.floor(Math.random() * availableLevels.length)];
      const items = [...level.items];
      shuffleArray(items);

      correctAnswer = items[Math.floor(Math.random() * items.length)];

      // Decide if round is drag or select randomly
      const isDrag = Math.random() < 0.5;

      questionDisplay.textContent = "Find the " + correctAnswer.name;
      speak("Find the " + correctAnswer.name);

      dropZone.style.display = isDrag ? "flex" : "none";
      grid.innerHTML = "";
      const shown = items.slice(0,6);
      if (!shown.includes(correctAnswer)) shown[0] = correctAnswer;
      shuffleArray(shown);

      shown.forEach(opt => {
        const box = document.createElement("div");
        box.className = "answer-box";
        box.textContent = opt.emoji;
        box.draggable = isDrag;
        box.onclick = () => { if(!isDrag) checkAnswer(opt) };

        box.addEventListener("dragstart", e => {
          box.classList.add("dragging");
          e.dataTransfer.setData("text/plain", opt.emoji);
        });
        box.addEventListener("dragend", () => box.classList.remove("dragging"));

        grid.appendChild(box);
      });
    }

    function checkAnswer(choice) {
      if (choice === correctAnswer.emoji) {
        successSound.play();
        score++;
        scoreDisplay.textContent = `Score: ${score}`;
        messageDisplay.textContent = "âœ… Correct!";
        setTimeout(newRound, 1000);
      } else {
        buzzSound.play();
        messageDisplay.textContent = "âŒ Try again!";
      }
    }

    dropZone.addEventListener("dragover", e => e.preventDefault());
    dropZone.addEventListener("drop", e => {
      e.preventDefault();
      checkAnswer(e.dataTransfer.getData("text/plain"));
    });

    newRound();
  </script>
</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Colors Game</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap');
    body { font-family: 'Inter', sans-serif; -webkit-tap-highlight-color: transparent; }
    .bouncy-tap { transition: transform 0.1s ease-in-out; }
    .bouncy-tap:active { transform: scale(0.95); }
    .incorrect-animation { animation: incorrect-shake 0.3s ease-in-out; }
    .correct-pop-out { position: relative; z-index: 50; animation: popOut 0.8s ease-in-out forwards; }
    .correct-pop-out::after {
      content: ''; position: absolute; top: 50%; left: 50%;
      width: 150%; height: 150%; border-radius: 50%;
      background-image: radial-gradient(circle, white 10%, transparent 10%),
                        radial-gradient(circle, white 10%, transparent 10%);
      background-position: 0% 0%, 100% 100%;
      background-size: 50% 50%, 50% 50%; background-repeat: no-repeat;
      transform: translate(-50%, -50%) scale(0); opacity: 0;
      animation: diamond-shine 0.8s ease-out forwards; pointer-events: none;
    }
    @keyframes incorrect-shake { 0%,100%{transform:translateX(0);}25%{transform:translateX(-5px);}75%{transform:translateX(5px);} }
    @keyframes popOut {0%{transform:scale(1);}50%{transform:scale(1.5);}100%{transform:scale(1.5);} }
    @keyframes diamond-shine {0%{transform:translate(-50%,-50%) scale(0);opacity:0;}50%{transform:translate(-50%,-50%) scale(1);opacity:1;}100%{transform:translate(-50%,-50%) scale(1.5);opacity:0;}}
    .fireworks-container { position:absolute; top:0; left:0; width:100%; height:100%; pointer-events:none; overflow:hidden; z-index:10; }
    .firework { position:absolute; width:5px; height:5px; background-color:#fff; border-radius:50%; animation:explode 1s ease-out forwards; }
    @keyframes explode {0%{transform:scale(1);opacity:1;}100%{transform:scale(100);opacity:0;}}
    .star { position:absolute; width:8px; height:8px; background-color:#facc15; border-radius:50%; transform:scale(0); opacity:0; animation:sparkle 0.8s ease-out forwards;}
    @keyframes sparkle {0%{transform:scale(0);opacity:0;}30%{transform:scale(1);opacity:1;}100%{transform:scale(0);opacity:0;transform:translateY(-50px);} }
  </style>
</head>
<body class="bg-gray-100 min-h-screen flex items-center justify-center p-4 overflow-hidden">
  <div id="game-container" class="w-full max-w-lg p-6 bg-white rounded-3xl shadow-xl flex flex-col items-center space-y-8">
    <h1 id="game-title" class="text-4xl sm:text-5xl font-bold text-center text-gray-800">
      Find the <span id="color-name" class="text-blue-500">...</span>
    </h1>
    <div id="score-board" class="w-full text-center text-2xl font-bold text-gray-600">
      Score: <span id="score-count">0</span>
    </div>
    <div id="colors-grid" class="flex flex-wrap justify-center items-center gap-6 w-full"></div>
    <div id="message-box" class="min-h-16 w-full text-center">
      <p id="message-text" class="text-xl font-semibold hidden"></p>
    </div>
  </div>

  <!-- Celebration Screen -->
  <div id="win-screen" class="absolute inset-0 bg-blue-500 bg-opacity-90 flex flex-col items-center justify-center p-4 space-y-8 z-20 hidden">
    <div class="fireworks-container" id="fireworks"></div>
    <h2 id="win-message" class="text-6xl font-extrabold text-white text-center">You Did It!</h2>
    <p id="win-subtext" class="text-2xl text-white text-center font-semibold">You found all the colors!</p>
    <button id="back-to-menu-btn" class="bg-white text-blue-600 px-8 py-4 rounded-full shadow-lg font-bold text-lg transform active:scale-95 transition-transform">
      Back to Menu
    </button>
  </div>

<script>
  // Colors
  const allColors = [
    { name: 'Red', hex: '#ef4444' }, { name: 'Blue', hex: '#3b82f6' },
    { name: 'Green', hex: '#22c55e' }, { name: 'Yellow', hex: '#facc15' },
    { name: 'Purple', hex: '#a855f7' }, { name: 'Orange', hex: '#f97316' },
    { name: 'Pink', hex: '#ec4899' }, { name: 'Brown', hex: '#8a4b08' },
    { name: 'Gray', hex: '#9ca3af' }, { name: 'Black', hex: '#111827' },
    { name: 'White', hex: '#f9fafb' }, { name: 'Teal', hex: '#14b8a6' },
  ];
  const positiveFeedback = ['Excellent!', 'Great Job!', 'You are doing great!', 'Fantastic!', 'Super!'];
  const negativeFeedback = ['Oops, try again!', 'Not quite, give it another go!', 'You can do it!'];

  // 🎵 Sounds
  const successSounds = [
    new Audio("https://actions.google.com/sounds/v1/cartoon/clang_and_wobble.ogg"),
    new Audio("https://actions.google.com/sounds/v1/cartoon/wood_plank_flicks.ogg"),
    new Audio("https://actions.google.com/sounds/v1/cartoon/concussive_drum_hit.ogg"),
    new Audio("https://actions.google.com/sounds/v1/cartoon/pop.ogg"),
    new Audio("https://actions.google.com/sounds/v1/cartoon/clang.ogg")
  ];
  const failSounds = [
    new Audio("https://actions.google.com/sounds/v1/cartoon/wood_plank_flicks.ogg"),
    new Audio("https://actions.google.com/sounds/v1/cartoon/boing.ogg"),
    new Audio("https://actions.google.com/sounds/v1/cartoon/wood_plank_flicks.ogg"),
    new Audio("https://actions.google.com/sounds/v1/alarms/beep_short.ogg")
  ];
  successSounds.forEach(s => s.preload="auto");
  failSounds.forEach(s => s.preload="auto");

  function playRandomSound(list) {
    const sound = list[Math.floor(Math.random() * list.length)];
    try { sound.currentTime = 0; sound.play(); } catch(e) { console.error(e); }
  }

  // Game state
  let correctColor=null, previousColor=null, score=0, currentLevel=1, fireworkIntervalId=null;
  const CORRECT_ANSWERS_TO_LEVEL_UP = 5;
  const CELEBRATION_LEVEL_INTERVAL = 2;
  const COLORS_PER_LEVEL = [4,6,8,8,10,10,12,12,12,12];

  const speak = (text, callback, rate=0.9) => {
    if ('speechSynthesis' in window) {
      window.speechSynthesis.cancel();
      const utterance = new SpeechSynthesisUtterance(text);
      utterance.rate = rate;
      utterance.onend = () => { if (callback) callback(); };
      window.speechSynthesis.speak(utterance);
    } else if (callback) callback();
  };

  const createColorButton = (color) => {
    const button=document.createElement('div');
    button.className="w-20 h-20 md:w-24 md:h-24 rounded-3xl shadow-md cursor-pointer transition-all bouncy-tap";
    button.style.backgroundColor=color.hex;
    button.dataset.colorName=color.name;
    return button;
  };
  const updateScoreDisplay = () => { document.getElementById('score-count').textContent=score; };
  const generateFirework = () => {
    const f=document.createElement('div');
    f.className='firework';
    f.style.width=f.style.height=`${Math.random()*20+5}px`;
    f.style.backgroundColor=`hsl(${Math.random()*360},100%,80%)`;
    f.style.left=`${Math.random()*100}vw`;
    f.style.top=`${Math.random()*100}vh`;
    document.getElementById('fireworks').appendChild(f);
    f.addEventListener('animationend',()=>f.remove());
  };
  const generateStars=(button)=>{
    const rect=button.getBoundingClientRect(); const c=10;
    for(let i=0;i<c;i++){const s=document.createElement('div');s.className='star';
      s.style.left=`${rect.left+rect.width/2+(Math.random()-0.5)*50}px`;
      s.style.top=`${rect.top+rect.height/2+(Math.random()-0.5)*50}px`;
      document.body.appendChild(s);
      s.addEventListener('animationend',()=>s.remove());
    }
  };

  const showCelebrationScreen=(msg,sub,isFinal=false)=>{
    const gc=document.getElementById('game-container');const ws=document.getElementById('win-screen');
    gc.classList.add('hidden'); ws.classList.remove('hidden');
    document.getElementById('win-message').textContent=msg;
    document.getElementById('win-subtext').textContent=sub;
    const back=document.getElementById('back-to-menu-btn');
    if(isFinal){back.classList.remove('hidden');back.onclick=()=>{clearInterval(fireworkIntervalId);window.location.href='main_page.html';};}
    else{back.classList.add('hidden');}
    if(fireworkIntervalId)clearInterval(fireworkIntervalId);
    fireworkIntervalId=setInterval(generateFirework,300);
    speak(msg,()=>{if(!isFinal){setTimeout(()=>{ws.classList.add('hidden');gc.classList.remove('hidden');clearInterval(fireworkIntervalId);setupNewRound();},2500);}});
  };

  const handleTap=(e)=>{
    const tapped=e.target.dataset.colorName;
    const msg=document.getElementById('message-text');
    const btn=e.target;
    if(tapped===correctColor.name){
      score++; btn.classList.add('correct-pop-out'); generateStars(btn);
      playRandomSound(successSounds); // ✅ Correct sound
      const fb=positiveFeedback[Math.floor(Math.random()*positiveFeedback.length)];
      speak(correctColor.name,()=>{speak(fb,()=>{
        msg.textContent=fb; msg.classList.remove('hidden'); msg.style.color=correctColor.hex;
        setTimeout(()=>{btn.classList.remove('correct-pop-out');msg.classList.add('hidden');updateScoreDisplay();
          if(score>=CORRECT_ANSWERS_TO_LEVEL_UP){currentLevel++;score=0;updateScoreDisplay();
            if(currentLevel%CELEBRATION_LEVEL_INTERVAL===0){showCelebrationScreen('Great Job!',`You completed Level ${currentLevel-1}!`,false);}
            else setupNewRound();
          }else setupNewRound();
        },800);
      });});
    }else{
      score=0; updateScoreDisplay(); btn.classList.add('incorrect-animation');
      const fb=negativeFeedback[Math.floor(Math.random()*negativeFeedback.length)];
      msg.textContent=fb; msg.classList.remove('hidden'); msg.style.color=correctColor.hex;
      playRandomSound(failSounds); // ❌ Wrong sound
      speak(fb);
      btn.addEventListener('animationend',()=>btn.classList.remove('incorrect-animation'),{once:true});
    }
  };

  const resetGame=()=>{document.getElementById('colors-grid').innerHTML='';correctColor=null;};
  const setupNewRound=()=>{
    resetGame(); const display=document.getElementById('color-name');
    const num=COLORS_PER_LEVEL[currentLevel-1]||allColors.length;
    const shuffled=[...allColors].sort(()=>Math.random()-0.5);
    let newColor; do{newColor=shuffled[0];}while(newColor.name===previousColor?.name);
    correctColor=newColor; previousColor=correctColor;
    const round=shuffled.slice(0,num); if(!round.includes(correctColor))round[0]=correctColor;
    round.sort(()=>Math.random()-0.5);
    display.textContent=correctColor.name; display.style.color=correctColor.hex;
    speak(`Find the color ${correctColor.name}.`);
    const grid=document.getElementById('colors-grid');
    round.forEach(c=>{const b=createColorButton(c);b.addEventListener('click',handleTap);grid.appendChild(b);});
  };
  window.onload=()=>{setTimeout(()=>{setupNewRound();updateScoreDisplay();},500);};
</script>
</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Kids Logic Game</title>
<style>
body {
    font-family: 'Comic Sans MS', cursive, sans-serif;
    margin: 0; padding: 0;
    height: 100vh; width: 100vw;
    display: flex; justify-content: center; align-items: center;
    background: linear-gradient(135deg, #ffe6f0 0%, #b3e5fc 50%, #c8e6c9 100%);
    overflow: hidden;
}
.container {
    background: rgba(255, 245, 157, 0.95);
    border-radius: 25px; padding: 15px;
    width: 100%; max-width: 500px;
    min-height: 100vh; text-align: center;
    box-shadow: 0 8px 20px rgba(0,0,0,0.15);
    box-sizing: border-box;
    display:flex; flex-direction: column; align-items: center;
}
h1 { color: #d81b60; font-size: 2rem; margin:10px 0; }
.emoji-grid { display:grid; grid-template-columns: repeat(auto-fit,minmax(80px,1fr)); gap:10px; margin:20px 0; }
.options-grid { display:grid; grid-template-columns: repeat(3,1fr); gap:10px; margin:15px 0; }
.emoji-item { font-size: 1rem; background: #fff3e0; border-radius: 15px; cursor: pointer; padding: 10px; display:flex; align-items:center; justify-content:center; position:relative; border:2px solid #444; }
.emoji-item img { max-width: 100%; max-height: 100%; }
.emoji-item.correct { animation: starEffect 1s forwards; }
@keyframes starEffect {
  0% { transform: scale(1); box-shadow: 0 0 0 #ffd700; }
  50% { transform: scale(1.3); box-shadow: 0 0 15px 8px rgba(255,215,0,0.7); }
  100% { transform: scale(1); box-shadow: 0 0 0 transparent; }
}
.instructions { font-size:1.4rem; color:#d81b60; margin:10px 0; }
.start-btn { font-size:2rem; font-weight:bold; padding:20px 30px; background: linear-gradient(45deg,#ff4081,#ff80ab); color:white; border:none; border-radius:20px; cursor:pointer; box-shadow:0 0 20px #ffd700; animation: glow 1.5s infinite alternate; }
@keyframes glow {
  0% { box-shadow:0 0 20px #ffd700; }
  100% { box-shadow:0 0 40px #ffeb3b; }
}
.top-bar { display:flex; justify-content: space-between; width:100%; align-items:center; padding:0 10px; }
.level-display { color:#0288d1; font-size:1.2rem; font-weight:bold; }
.exit-btn { background:#ff4081; color:white; font-weight:bold; padding:10px 20px; border-radius:12px; border:none; cursor:pointer; font-size:1.2rem; margin:10px; }
.progress-bar { width:100%; background:#eee; border-radius:10px; overflow:hidden; margin:10px 0; height:15px; }
.progress-bar-fill { height:100%; width:0%; background:#4caf50; transition:width 0.5s; }
</style>
</head>
<body>
<div class="container" id="game-container">
  <h1>Fun Logic Adventure ðŸŒŸ</h1>
  <button class="start-btn" id="start-btn">Start Game</button>
</div>

<audio id="bg-music" loop preload="auto">
  <source src="https://cdn.pixabay.com/audio/2022/03/15/audio_2a9b9d347d.mp3" type="audio/mpeg">
</audio>

<script>
const gameContainer = document.getElementById('game-container');
const startBtn = document.getElementById('start-btn');
const bgMusic = document.getElementById('bg-music');

const imageList = [
  'apple','ball','banana','car','cat','cherry','dog','fish','flower',
  'kiwi','orange','pinapple','rabbit','rainbow','star','strawberry','syn','teddy','train'
];

const levelTypes = ['findTarget','findMissing','findDifferent'];
const maxLevels = 100;
let level=1;
let currentTarget='';
let score=0;

// Preload all images
function preloadImages(callback){
  let loaded=0;
  imageList.forEach(name=>{
    const img=new Image();
    img.src=`image/${name}.png?v=${Date.now()}`;
    img.onload=()=>{ loaded++; if(loaded===imageList.length) callback(); };
    img.onerror=()=>{ console.warn('Image missing: '+name); loaded++; if(loaded===imageList.length) callback(); };
  });
}

// Speak function
function speak(text,rate=0.8){
  return new Promise(resolve=>{
    const synth=window.speechSynthesis;
    const utter=new SpeechSynthesisUtterance(text);
    utter.rate=rate;
    utter.pitch=1.2;
    utter.onend=()=>resolve();
    synth.speak(utter);
  });
}

// Shuffle
function shuffle(arr){ return arr.sort(()=>Math.random()-0.5); }

// Exit
function exitGame(){ bgMusic.pause(); window.location.href='index.html'; }

// Create instruction
function createInstructions(txt){ const p=document.createElement('p'); p.className='instructions'; p.innerText=txt; return p; }

// Start game
startBtn.onclick=()=>{
  preloadImages(()=>{
    bgMusic.volume=0.2; bgMusic.play().catch(()=>{});
    nextRound();
  });
};

// Progress bar
function createProgressBar(){
  const bar=document.createElement('div'); bar.className='progress-bar';
  const fill=document.createElement('div'); fill.className='progress-bar-fill'; bar.appendChild(fill);
  return {bar,fill};
}

// Next round
async function nextRound(){
  gameContainer.innerHTML='';
  const topBar=document.createElement('div'); topBar.className='top-bar';
  const title=document.createElement('h1'); title.innerText='Fun Logic Adventure ðŸŒŸ';
  const levelDisp=document.createElement('span'); levelDisp.className='level-display'; levelDisp.innerText='Level: '+level;
  const exitBtn=document.createElement('button'); exitBtn.className='exit-btn'; exitBtn.innerText='Exit'; exitBtn.onclick=exitGame;
  topBar.appendChild(title); topBar.appendChild(exitBtn); gameContainer.appendChild(topBar);
  gameContainer.appendChild(levelDisp);

  // Tutorial first 3 levels
  if(level<=3) await speak('This is how you play. Follow the instructions carefully!',0.7);

  const type = levelTypes[(level-1)%levelTypes.length];
  if(type==='findTarget') await findTargetRound();
  else if(type==='findMissing') await missingRound();
  else if(type==='findDifferent') await differentRound();
}

// Find Target
async function findTargetRound(){
  const chosen = shuffle([...imageList]).slice(0,Math.min(4,3+Math.floor(level/20)));
  currentTarget = chosen[Math.floor(Math.random()*chosen.length)];
  gameContainer.appendChild(createInstructions('Find the '+currentTarget));

  await speak('Find the '+currentTarget,0.7 + level/50);

  const grid=document.createElement('div'); grid.className='emoji-grid';
  chosen.forEach(name=>{
    const div=document.createElement('div'); div.className='emoji-item';
    const img=document.createElement('img'); img.src=`image/${name}.png?v=${Date.now()}`;
    div.appendChild(img);
    div.onclick=()=>checkAnswer(div,name,currentTarget,grid);
    grid.appendChild(div);
  });
  gameContainer.appendChild(grid);
}

// Missing Round
async function missingRound(){
  const gridSize=6;
  let chosen = shuffle([...imageList]).slice(0,gridSize);
  currentTarget = chosen[gridSize-1]; 
  const gridImages = [...chosen]; 
  gridImages[gridSize-1]='blank';

  gameContainer.appendChild(createInstructions('Find the missing item'));
  await speak('Find the missing item',0.7 + level/50);

  const grid=document.createElement('div'); grid.className='emoji-grid';
  gridImages.forEach(name=>{
    const div=document.createElement('div'); div.className='emoji-item';
    if(name==='blank'){ div.innerHTML='?'; div.style.background='#e0e0e0'; }
    else { const img=document.createElement('img'); img.src=`image/${name}.png?v=${Date.now()}`; div.appendChild(img); }
    grid.appendChild(div);
  });
  gameContainer.appendChild(grid);

  const distractors=shuffle(imageList.filter(x=>!chosen.includes(x))).slice(0,2);
  const options=shuffle([currentTarget,...distractors]);
  const optGrid=document.createElement('div'); optGrid.className='options-grid';
  options.forEach(name=>{
    const div=document.createElement('div'); div.className='emoji-item';
    const img=document.createElement('img'); img.src=`image/${name}.png?v=${Date.now()}`; div.appendChild(img);
    div.onclick=async ()=>{
      if(name===currentTarget){
        const blankDiv = Array.from(grid.children).find(d=>d.innerHTML==='?');
        blankDiv.innerHTML=`<img src="image/${name}.png?v=${Date.now()}" />`;
        await checkAnswer(blankDiv,name,currentTarget,grid);
      } else {
        div.style.border='2px solid red';
        await speak('Oops! Try again',0.9);
        setTimeout(()=>{ div.style.border='2px solid #444'; },800);
      }
    };
    optGrid.appendChild(div);
  });
  gameContainer.appendChild(optGrid);
}

// Different Round
async function differentRound(){
  const chosen = shuffle([...imageList]).slice(0,Math.min(5,4+Math.floor(level/20)));
  const sameItem = chosen[0];
  const diffIndex=Math.floor(Math.random()*chosen.length);
  currentTarget=shuffle([...imageList].filter(x=>!chosen.includes(x)))[0];
  chosen[diffIndex]=currentTarget;

  gameContainer.appendChild(createInstructions('Find the different item'));
  await speak('Find the different item',0.7 + level/50);

  const grid=document.createElement('div'); grid.className='emoji-grid';
  chosen.forEach(name=>{
    const div=document.createElement('div'); div.className='emoji-item';
    const img=document.createElement('img'); img.src=`image/${name}.png?v=${Date.now()}`;
    div.appendChild(img);
    div.onclick=()=>checkAnswer(div,name,currentTarget,grid);
    grid.appendChild(div);
  });
  gameContainer.appendChild(grid);
}

// Check answer
async function checkAnswer(div,name,target,grid){
  if(name===target){
    div.classList.add('correct');
    score+=10;
    await speak('Yay! You did it!',0.9 + level/50);
    setTimeout(()=>{
      if(level<maxLevels){ level++; nextRound(); }
      else {
        gameContainer.innerHTML=`<h1>Congratulations! ðŸŽ‰</h1><p>Your Score: ${score}</p><button class="start-btn" onclick="level=1;score=0;nextRound()">Play Again</button>`;
      }
    },1200);
  } else {
    div.style.border='2px solid red';
    await speak('Oops! Try again',0.8);
    setTimeout(()=>{ div.style.border='2px solid #444'; },800);
  }
}
</script>
</body>
</html>

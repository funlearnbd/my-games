<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Kids Logic Game</title>
<style>
body {
    font-family: 'Comic Sans MS', cursive, sans-serif;
    margin: 0; padding: 0;
    height: 100vh; width: 100vw;
    display: flex; justify-content: center; align-items: center;
    background: linear-gradient(135deg, #ffe6f0 0%, #b3e5fc 50%, #c8e6c9 100%);
    overflow: hidden;
}

.container {
    text-align: center;
    width: 100%; max-width: 500px; min-height: 100vh;
    display: flex; flex-direction: column; justify-content: center; align-items: center;
}

#start-btn {
    font-size: 2rem; font-weight: bold;
    padding: 20px 40px; border-radius: 25px;
    background: linear-gradient(45deg, #ff4081, #ffca28, #29b6f6);
    color: white; border: none; cursor: pointer;
    box-shadow: 0 0 20px gold;
    animation: shine 2s infinite;
}

@keyframes shine {
    0%, 100% { box-shadow: 0 0 20px gold; }
    50% { box-shadow: 0 0 40px gold; }
}

.loading-screen {
    position: fixed; top:0; left:0; width:100%; height:100%;
    background: rgba(0,0,0,0.7); display:flex;
    justify-content:center; align-items:center; flex-direction: column;
    color: white; font-size: 1.5rem; z-index: 9999;
}

.emoji-grid, .options-grid {
    display: grid; gap: 10px; margin: 15px 10px;
}

.emoji-grid { grid-template-columns: repeat(auto-fit, minmax(80px,1fr)); }
.options-grid { grid-template-columns: repeat(3, 1fr); }

.emoji-item {
    width: 100%; aspect-ratio: 1/1;
    background: #fff3e0; border: 3px solid #555;
    border-radius: 12px; cursor: pointer;
    display: flex; justify-content: center; align-items: center;
    position: relative; overflow: hidden;
    transition: transform 0.2s, box-shadow 0.2s;
}

.emoji-item img {
    width: 80%; height: 80%; object-fit: contain;
}

.emoji-item:hover { transform: scale(1.1); box-shadow: 0 0 15px gold; }

.correct img {
    animation: sparkle 1s ease-out;
}

@keyframes sparkle {
    0% { transform: scale(1); filter: drop-shadow(0 0 0 gold); }
    50% { transform: scale(1.3); filter: drop-shadow(0 0 15px gold); }
    100% { transform: scale(1); filter: drop-shadow(0 0 0 transparent); }
}

.exit-btn {
    background: #ff4081; color:white; font-weight:bold;
    padding: 10px 20px; border-radius:12px; border:none; cursor:pointer;
    font-size: 1.2rem; margin:10px;
}

.instructions { font-size: 1.2rem; color:#d81b60; margin:10px 0; }
</style>
</head>
<body>
<div class="container" id="game-container">
    <h1>Fun Logic Adventure ðŸŒŸ</h1>
    <button id="start-btn">Start Game</button>
</div>

<audio id="bg-music" loop preload="auto">
    <source src="https://cdn.pixabay.com/audio/2022/03/15/audio_2a9b9d347d.mp3" type="audio/mpeg">
</audio>

<script>
const gameContainer = document.getElementById('game-container');
const startBtn = document.getElementById('start-btn');
const bgMusic = document.getElementById('bg-music');

const imageList = ['apple','ball','banana','car','cat','cherry','dog','fish','flower','kiwi'];
const feedback = ['Super job! ðŸŒŸ','Wow, awesome!','Youâ€™re a star!','Fantastic!','Yay, you did it!'];
const levelTypes = ['target','missing','different']; // rotate modes
let level = 1, maxLevels = 20, currentTarget='', currentMode='target';

function speak(text, callback=null){
    const synth = window.speechSynthesis;
    const utter = new SpeechSynthesisUtterance(text);
    utter.rate = Math.min(0.7 + level/50,1.2);
    utter.pitch = 1.3;
    synth.speak(utter);
    if(callback) utter.onend=callback;
}

function shuffle(arr){ return arr.sort(()=>Math.random()-0.5); }

function preloadImages(images, callback){
    const loadingOverlay=document.createElement('div');
    loadingOverlay.className='loading-screen';
    const loadingText=document.createElement('div'); loadingText.innerText='Loading 0%';
    loadingOverlay.appendChild(loadingText);
    document.body.appendChild(loadingOverlay);

    let loaded=0;
    images.forEach(name=>{
        const img=new Image();
        img.src=`image/${name}.png?v=${Date.now()}`;
        img.onload=img.onerror=()=>{
            loaded++;
            loadingText.innerText=`Loading ${Math.floor(loaded/images.length*100)}%`;
            if(loaded===images.length){
                setTimeout(()=>{ loadingOverlay.remove(); callback(); },300);
            }
        };
    });
}

function startGame(){
    bgMusic.volume=0.2; bgMusic.play().catch(()=>{});
    level=1; nextRound();
}

function nextRound(){
    gameContainer.innerHTML='';
    currentMode=levelTypes[level%levelTypes.length];
    if(currentMode==='target'){
        renderTarget();
    }else if(currentMode==='missing'){
        renderMissing();
    }else{
        renderDifferent();
    }
}

let lastTarget = ''; // global variable to remember last target

function getNewTarget(chosen){
    let newTarget = shuffle(chosen)[0];
    if(chosen.length > 1){
        while(newTarget === lastTarget){
            newTarget = shuffle(chosen)[0];
        }
    }
    lastTarget = newTarget;
    return newTarget;
}


    
function renderTarget(){
    gameContainer.innerHTML=`<h1>Level ${level}</h1>`;
    const chosen=shuffle(imageList).slice(0,4);
    currentTarget=shuffle(chosen)[0];
    const instructions=document.createElement('p'); instructions.className='instructions';
    instructions.innerText=`Find the ${currentTarget}`;
    gameContainer.appendChild(instructions);
    speak(`Find the ${currentTarget}`);

    const grid=document.createElement('div'); grid.className='emoji-grid';
    chosen.forEach(name=>{
        const div=document.createElement('div'); div.className='emoji-item';
        const img=document.createElement('img'); img.src=`image/${name}.png?v=${Date.now()}`;
        div.appendChild(img);
        div.onclick=()=>checkAnswer(div,name,currentTarget);
        grid.appendChild(div);
    });
    gameContainer.appendChild(grid);
}

function renderMissing(){
    gameContainer.innerHTML=`<h1>Level ${level}</h1>`;
    const chosen=shuffle(imageList).slice(0,5); 
    currentTarget=shuffle(chosen)[0]; // missing one
    const blankIndex=chosen.indexOf(currentTarget);
    chosen[blankIndex]='blank';
    const instructions=document.createElement('p'); instructions.className='instructions';
    instructions.innerText=`Find the missing item`;
    gameContainer.appendChild(instructions);
    speak(`Find the missing item`);

    const grid=document.createElement('div'); grid.className='emoji-grid';
    chosen.forEach(name=>{
        const div=document.createElement('div'); div.className='emoji-item';
        if(name==='blank'){ div.style.background='#e0e0e0'; } 
        else{ 
            const img=document.createElement('img'); img.src=`image/${name}.png?v=${Date.now()}`; div.appendChild(img);
        }
        grid.appendChild(div);
    });
    gameContainer.appendChild(grid);

    // Options
    const options=[currentTarget, ...shuffle(imageList.filter(i=>i!==currentTarget)).slice(0,2)];
    shuffle(options);
    const optionsGrid=document.createElement('div'); optionsGrid.className='options-grid';
    options.forEach(name=>{
        const div=document.createElement('div'); div.className='emoji-item';
        const img=document.createElement('img'); img.src=`image/${name}.png?v=${Date.now()}`;
        div.appendChild(img);
        div.onclick=()=>fillBlank(div,name,currentTarget,grid,blankIndex);
        optionsGrid.appendChild(div);
    });
    gameContainer.appendChild(optionsGrid);
}

function fillBlank(div,name,target,grid,index){
    if(name===target){
        grid.children[index].innerHTML=`<img src="image/${target}.png?v=${Date.now()}">`;
        div.classList.add('correct');
        const say=feedback[Math.floor(Math.random()*feedback.length)];
        speak(say,()=>{
            level++; nextRound();
        });
    } else {
        div.style.transform='scale(1.1)';
        setTimeout(()=>{ div.style.transform='scale(1)'; },500);
    }
}

function renderDifferent(){
    gameContainer.innerHTML=`<h1>Level ${level}</h1>`;
    const same=shuffle(imageList).slice(0,1)[0];
    const different=shuffle(imageList.filter(i=>i!==same))[0];
    currentTarget=different;
    const arr=Array(4).fill(same);
    const diffIndex=Math.floor(Math.random()*4);
    arr[diffIndex]=different;

    const instructions=document.createElement('p'); instructions.className='instructions';
    instructions.innerText='Find the uncommon item';
    gameContainer.appendChild(instructions);
    speak('Find the uncommon item');

    const grid=document.createElement('div'); grid.className='emoji-grid';
    arr.forEach(name=>{
        const div=document.createElement('div'); div.className='emoji-item';
        const img=document.createElement('img'); img.src=`image/${name}.png?v=${Date.now()}`;
        div.appendChild(img);
        div.onclick=()=>checkAnswer(div,name,different);
        grid.appendChild(div);
    });
    gameContainer.appendChild(grid);
}

function checkAnswer(div,name,target){
    if(name===target){
        div.classList.add('correct');
        const say=feedback[Math.floor(Math.random()*feedback.length)];
        speak(say,()=>{
            level++; nextRound();
        });
    } else{
        div.style.transform='scale(1.1)';
        setTimeout(()=>{ div.style.transform='scale(1)'; },500);
    }
}

preloadImages(imageList, ()=>{ startBtn.onclick=startGame; });
</script>
</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Kids Logic Game</title>
  <style>
    body {
      font-family: 'Comic Sans MS', cursive, sans-serif;
      margin: 0;
      padding: 0;
      height: 100vh;
      width: 100vw;
      display: flex;
      justify-content: center;
      align-items: center;
      background: linear-gradient(135deg, #ffe6f0 0%, #b3e5fc 50%, #c8e6c9 100%);
      overflow: hidden;
    }
    .container {
      background: rgba(255, 245, 157, 0.9);
      border-radius: 25px;
      padding: 15px;
      width: 100%;
      max-width: 500px;
      min-height: 100vh;
      text-align: center;
      box-shadow: 0 8px 20px rgba(0,0,0,0.15);
      box-sizing: border-box;
    }
    h1 {
      margin: 10px 0;
      color: #d81b60;
      font-size: 2rem;
    }
    .emoji-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(90px, 1fr));
      gap: 12px;
      margin: 20px 10px;
    }
    .options-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 12px;
      margin: 20px 10px;
    }
    .emoji-item {
      font-size: 4rem;
      background: #fff3e0;
      border-radius: 15px;
      cursor: pointer;
      padding: 12px;
      transition: transform 0.2s, background-color 0.2s;
      aspect-ratio: 1/1;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .emoji-item:hover {
      transform: scale(1.25);
      background-color: #ffd54f;
    }
    .emoji-item.correct {
      animation: sparkle 1s ease-out;
    }
    .emoji-item.incorrect {
      animation: shake 0.5s ease-out;
    }
    @keyframes sparkle {
      0% { transform: scale(1); box-shadow: 0 0 0 0 #ffd700; }
      50% { transform: scale(1.3); box-shadow: 0 0 15px 8px rgba(255,215,0,0.7); }
      100% { transform: scale(1); box-shadow: 0 0 0 0 transparent; }
    }
    @keyframes shake {
      0%, 100% { transform: translateX(0); }
      25% { transform: translateX(-8px); }
      75% { transform: translateX(8px); }
    }
    .exit-btn, .start-btn {
      background: #ff4081;
      color: white;
      font-weight: bold;
      padding: 10px 20px;
      border-radius: 12px;
      border: none;
      cursor: pointer;
      font-size: 1.2rem;
      margin: 10px;
    }
    .top-bar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0 10px;
    }
    .level-display {
      color: #0288d1;
      font-size: 1.2rem;
      font-weight: bold;
    }
    .instructions {
      font-size: 1.4rem;
      color: #d81b60;
      margin: 10px 0;
    }
  </style>
</head>
<body>
  <div class="container" id="game-container">
    <div class="top-bar">
      <h1>Fun Logic Adventure 🌟</h1>
      <button onclick="exitGame()" class="exit-btn">Exit</button>
    </div>
    <p class="level-display">Level: <span id="level">1</span></p>
    <p class="instructions">Tap start to play!</p>
    <button class="start-btn" id="start-btn">Start Game</button>
  </div>

  <audio id="bg-music" loop preload="auto">
    <source src="https://cdn.pixabay.com/audio/2022/03/15/audio_2a9b9d347d.mp3" type="audio/mpeg">
  </audio>

  <script>
    const gameContainer = document.getElementById('game-container');
    const startBtn = document.getElementById('start-btn');
    const bgMusic = document.getElementById('bg-music');
    const levelDisplay = document.getElementById('level');

    const allEmojis = [
      '😺','🐶','🐰','🦒','🦁','🐘','🦋','🐝','🦄','🐢',
      '🍎','🍊','🍇','🍓','🍉','🍍','🍒','🥕','🥦','🍰',
      '🚗','🚒','✈️','🚀','🚲','🛵','🚁','🛸','🚤','🎈'
    ];

    const feedback = ['Super job! 🌟','Wow, awesome!','You’re a star!','Fantastic!','Yay, you did it!'];
    const levelTypes = [
      { type: 'findTarget', prompt: 'Find the' },
      { type: 'findMissing', prompt: 'Which one is missing?' },
      { type: 'findDifferent', prompt: 'Find the different item!' }
    ];

    let currentTarget = '';
    let level = 1;
    let score = 0;
    const maxLevels = 6;

    function speak(text) {
      const synth = window.speechSynthesis;
      const utter = new SpeechSynthesisUtterance(text);
      utter.rate = 0.7;
      utter.pitch = 1.1;
      synth.speak(utter);
    }

    function shuffle(arr) {
      return arr.sort(() => Math.random() - 0.5);
    }

    function startGame() {
      bgMusic.volume = 0.15;
      bgMusic.play().catch(err => console.log('Audio play failed:', err));
      level = 1;
      score = 0;
      levelDisplay.textContent = level;
      nextRound();
    }

    function getEmojisForLevel() {
      const emojiCounts = [4, 4, 5, 5, 6, 6];
      return shuffle([...allEmojis]).slice(0, emojiCounts[level - 1]);
    }

    function nextRound() {
      gameContainer.innerHTML = `
        <div class="top-bar">
          <h1>Fun Logic Adventure 🌟</h1>
          <button onclick="exitGame()" class="exit-btn">Exit</button>
        </div>
        <p class="level-display">Level: ${level}</p>
      `;

      const currentLevelType = levelTypes[level % levelTypes.length];
      let chosen = getEmojisForLevel();
      let instructionText = '';
      let correctAnswer = '';

      if (currentLevelType.type === 'findTarget') {
        currentTarget = chosen[Math.floor(Math.random() * chosen.length)];
        instructionText = `${currentLevelType.prompt} ${currentTarget}`;
        correctAnswer = currentTarget;

        showInstruction(instructionText);
        showEmojiGrid(chosen, correctAnswer);

      } else if (currentLevelType.type === 'findMissing') {
        // 5 emojis shown + 1 missing
        chosen = shuffle([...allEmojis]).slice(0, 6);
        correctAnswer = chosen.pop(); // last is missing
        currentTarget = correctAnswer;

        showInstruction(currentLevelType.prompt);

        // Grid with ❓ slot
        const grid = document.createElement('div');
        grid.className = 'emoji-grid';
        chosen.forEach(e => {
          const div = document.createElement('div');
          div.className = 'emoji-item';
          div.innerText = e;
          grid.appendChild(div);
        });
        const missingDiv = document.createElement('div');
        missingDiv.className = 'emoji-item';
        missingDiv.innerText = '❓';
        missingDiv.style.background = '#e0e0e0';
        grid.appendChild(missingDiv);
        gameContainer.appendChild(grid);

        // Options to pick the missing one
        const options = [correctAnswer, ...shuffle(allEmojis.filter(e => e !== correctAnswer)).slice(0, 2)];
        shuffle(options);

        const optionsGrid = document.createElement('div');
        optionsGrid.className = 'options-grid';
        options.forEach(e => {
          const div = document.createElement('div');
          div.className = 'emoji-item';
          div.innerText = e;
          div.onclick = () => checkAnswer(div, e, correctAnswer);
          optionsGrid.appendChild(div);
        });
        gameContainer.appendChild(optionsGrid);

      } else if (currentLevelType.type === 'findDifferent') {
        const baseEmoji = chosen[0];
        const gridEmojis = Array(chosen.length).fill(baseEmoji);
        correctAnswer = chosen[1]; // different one
        const diffIndex = Math.floor(Math.random() * gridEmojis.length);
        gridEmojis[diffIndex] = correctAnswer;
        currentTarget = correctAnswer;

        showInstruction(currentLevelType.prompt);
        showEmojiGrid(gridEmojis, correctAnswer);
      }
    }

    function showInstruction(text) {
      const instructions = document.createElement('p');
      instructions.className = 'instructions';
      instructions.innerText = text;
      gameContainer.appendChild(instructions);
      speak(text);
    }

    function showEmojiGrid(emojis, correctAnswer) {
      const grid = document.createElement('div');
      grid.className = 'emoji-grid';
      emojis.forEach(e => {
        const div = document.createElement('div');
        div.className = 'emoji-item';
        div.innerText = e;
        div.onclick = () => checkAnswer(div, e, correctAnswer);
        grid.appendChild(div);
      });
      gameContainer.appendChild(grid);
    }

    function checkAnswer(div, emoji, correctAnswer) {
      if (emoji === correctAnswer) {
        div.classList.add('correct');
        score += 10;
        const say = feedback[Math.floor(Math.random() * feedback.length)];
        speak(say);
        setTimeout(() => {
          if (level < maxLevels) {
            level++;
            levelDisplay.textContent = level;
            nextRound();
          } else {
            gameContainer.innerHTML = `
              <div class="top-bar">
                <h1>Game Over! 🎉</h1>
                <button onclick="exitGame()" class="exit-btn">Exit</button>
              </div>
              <p class="instructions">You won! Your score: ${score}</p>
              <button class="start-btn" onclick="startGame()">Play Again</button>
            `;
            speak('Congratulations, you won!');
          }
        }, 1500);
      } else {
        div.classList.add('incorrect');
        speak('Oops, try again!');
        setTimeout(() => div.classList.remove('incorrect'), 800);
      }
    }

    function exitGame() {
      bgMusic.pause();
      window.location.href = 'index.html';
    }

    startBtn.onclick = startGame;
  </script>
</body>
</html>

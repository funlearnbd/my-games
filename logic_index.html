<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Kids Logic Game</title>
<style>
  body {
    font-family: 'Comic Sans MS', cursive, sans-serif;
    margin: 0; padding: 0;
    display: flex; justify-content: center; align-items: center;
    background: linear-gradient(135deg, #ffe6f0 0%, #b3e5fc 50%, #c8e6c9 100%);
    height: 100vh; overflow: hidden;
  }
  .container {
    width: 100%; max-width: 500px; min-height: 100vh;
    text-align: center; position: relative;
  }
  .start-btn {
    font-size: 2rem; padding: 20px 40px; margin-top: 40%;
    border-radius: 20px; background: linear-gradient(45deg,#ff4081,#ff80ab);
    color: #fff; font-weight: bold; cursor: pointer;
    box-shadow: 0 0 30px #ff80ab;
    animation: pulse 1.5s infinite;
  }
  @keyframes pulse {
    0% { box-shadow: 0 0 10px #ff80ab; transform: scale(1); }
    50% { box-shadow: 0 0 30px #ff80ab; transform: scale(1.05); }
    100% { box-shadow: 0 0 10px #ff80ab; transform: scale(1); }
  }
  .emoji-grid, .options-grid {
    display: grid; gap: 10px; justify-items: center; margin: 15px;
  }
  .emoji-grid {
    grid-template-columns: repeat(auto-fit, minmax(80px, 1fr));
  }
  .options-grid {
    grid-template-columns: repeat(3, 1fr);
  }
  .emoji-item {
    width: 80px; height: 80px;
    border: 2px solid #333; border-radius: 12px;
    cursor: pointer; display: flex; justify-content: center; align-items: center;
    background: #fff; transition: transform 0.3s, box-shadow 0.3s;
    position: relative;
  }
  .emoji-item img {
    width: 70%; height: 70%; object-fit: contain;
  }
  .emoji-item.correct::after {
    content: '‚≠ê'; position: absolute; top: -10px; right: -10px; font-size: 1.5rem;
    animation: starpop 0.8s ease-out;
  }
  @keyframes starpop {
    0% { transform: scale(0); opacity: 0; }
    50% { transform: scale(1.5); opacity: 1; }
    100% { transform: scale(1); opacity: 1; }
  }
  .level-display { font-size: 1.2rem; font-weight: bold; color: #0288d1; margin: 10px; }
  .instructions { font-size: 1.4rem; color: #d81b60; margin: 10px; }
  .exit-btn { position: absolute; top: 10px; right: 10px; padding: 8px 15px; border-radius: 10px;
    background: #ff4081; color: #fff; font-weight: bold; border: none; cursor: pointer; }
  .loading-screen { position: fixed; top:0; left:0; width:100%; height:100%; background:#fff; display:flex;
    justify-content:center; align-items:center; z-index:1000; flex-direction:column; }
  .loading-text { font-size:2rem; color:#d81b60; }
</style>
</head>
<body>
<div class="container" id="game-container">
  <button class="start-btn" id="start-btn">Start Game</button>
</div>

<audio id="bg-music" loop preload="auto">
  <source src="https://cdn.pixabay.com/audio/2022/03/15/audio_2a9b9d347d.mp3" type="audio/mpeg">
</audio>

<script>
const gameContainer = document.getElementById('game-container');
const startBtn = document.getElementById('start-btn');
const bgMusic = document.getElementById('bg-music');

const imageList = ['apple','ball','banana','car','cat','cherry','dog','fish','flower','kiwi'];
let images = {};
let level = 1;
const maxLevels = 20;
let usedTargets = [];
let currentRoundType = '';
let currentTarget = '';
let synth = window.speechSynthesis;

// Preload images
function preloadImages(callback){
  const loadingOverlay = document.createElement('div');
  loadingOverlay.className = 'loading-screen';
  const loadingText = document.createElement('div');
  loadingText.className = 'loading-text';
  loadingText.innerText = 'Loading 0%';
  loadingOverlay.appendChild(loadingText);
  document.body.appendChild(loadingOverlay);

  let loaded = 0;
  imageList.forEach(name=>{
    const img = new Image();
    img.src = `image/${name}.png?v=${Date.now()}`;
    img.onload = img.onerror = ()=>{
      images[name] = img.src;
      loaded++;
      loadingText.innerText = `Loading ${Math.floor(loaded/imageList.length*100)}%`;
      if(loaded===imageList.length){
        setTimeout(()=>{ loadingOverlay.remove(); callback(); },300);
      }
    };
  });
}

// Speak helper
function speak(text, callback){
  if(!synth) { if(callback) callback(); return; }
  const utter = new SpeechSynthesisUtterance(text);
  utter.rate = Math.min(1.2, 0.7 + level*0.01);
  utter.pitch = 1.3;
  utter.onend = ()=>{ if(callback) callback(); };
  synth.speak(utter);
}

// Start Game
function startGame(){
  bgMusic.volume = 0.2; bgMusic.play().catch(()=>{});
  level = 1; usedTargets=[];
  nextRound();
}

// Choose next round type
function getRoundType(){
  const types = ['findTarget','findMissing','findDifferent'];
  return types[(level-1)%types.length];
}

// Avoid repeating last target
function pickTarget(){
  let available = imageList.filter(x=>!usedTargets.includes(x));
  if(available.length===0) usedTargets=[];
  let choice = available[Math.floor(Math.random()*available.length)];
  usedTargets.push(choice);
  return choice;
}

// Generate grid for findTarget
function generateTargetRound(){
  currentTarget = pickTarget();
  const chosen = shuffleArray([...imageList]).slice(0,4);
  if(!chosen.includes(currentTarget)) chosen[0]=currentTarget;
  renderGrid(chosen, 'Tap on '+currentTarget, currentTarget);
}

// Generate grid for findMissing
function generateMissingRound(){
  const chosen = shuffleArray([...imageList]).slice(0,6);
  currentTarget = chosen[5];
  const grid = chosen.slice(0,5);
  renderMissingGrid(grid, currentTarget);
}

// Generate grid for findDifferent
function generateDifferentRound(){
  const chosen = shuffleArray([...imageList]).slice(0,5);
  const common = chosen[0];
  for(let i=1;i<chosen.length;i++) chosen[i]=common;
  const diffIndex = Math.floor(Math.random()*chosen.length);
  currentTarget = pickTarget();
  chosen[diffIndex]=currentTarget;
  renderGrid(chosen, 'Find the different item!', currentTarget);
}

// Shuffle helper
function shuffleArray(arr){ return arr.sort(()=>Math.random()-0.5); }

// Render normal grid
function renderGrid(arr, instruction, correct){
  gameContainer.innerHTML='';
  const exitBtn = document.createElement('button'); exitBtn.className='exit-btn';
  exitBtn.innerText='Exit'; exitBtn.onclick=exitGame;
  gameContainer.appendChild(exitBtn);
  const levelDisp = document.createElement('div'); levelDisp.className='level-display';
  levelDisp.innerText='Level '+level; gameContainer.appendChild(levelDisp);
  const instr = document.createElement('div'); instr.className='instructions';
  instr.innerText=instruction; gameContainer.appendChild(instr);

  const grid = document.createElement('div'); grid.className='emoji-grid';
  arr.forEach(imgName=>{
    const div = document.createElement('div'); div.className='emoji-item';
    const img = document.createElement('img'); img.src=images[imgName];
    div.appendChild(img);
    div.onclick = ()=>checkAnswer(div,imgName,correct);
    grid.appendChild(div);
  });
  gameContainer.appendChild(grid);
  speak(instruction);
}

// Render missing grid
function renderMissingGrid(arr, missing){
  gameContainer.innerHTML='';
  const exitBtn = document.createElement('button'); exitBtn.className='exit-btn';
  exitBtn.innerText='Exit'; exitBtn.onclick=exitGame;
  gameContainer.appendChild(exitBtn);
  const levelDisp = document.createElement('div'); levelDisp.className='level-display';
  levelDisp.innerText='Level '+level; gameContainer.appendChild(levelDisp);
  const instr = document.createElement('div'); instr.className='instructions';
  instr.innerText='Find the missing item!'; gameContainer.appendChild(instr);

  const grid = document.createElement('div'); grid.className='emoji-grid';
  arr.forEach(imgName=>{
    const div = document.createElement('div'); div.className='emoji-item';
    const img = document.createElement('img'); img.src=images[imgName];
    div.appendChild(img);
    grid.appendChild(div);
  });
  const blankDiv = document.createElement('div'); blankDiv.className='emoji-item';
  blankDiv.style.background='#ccc'; grid.appendChild(blankDiv);
  gameContainer.appendChild(grid);

  // Options
  const options = shuffleArray([missing,...shuffleArray(imageList.filter(x=>x!==missing)).slice(0,2)]);
  const optGrid = document.createElement('div'); optGrid.className='options-grid';
  options.forEach(opt=>{
    const div = document.createElement('div'); div.className='emoji-item';
    const img = document.createElement('img'); img.src=images[opt];
    div.appendChild(img);
    div.onclick = ()=>{
      blankDiv.innerHTML=''; blankDiv.appendChild(img.cloneNode());
      checkAnswer(div,opt,missing);
    };
    optGrid.appendChild(div);
  });
  gameContainer.appendChild(optGrid);
  speak('Find the missing item!');
}

// Check answer
function checkAnswer(div,imgName,correct){
  if(imgName===correct){
    div.classList.add('correct');
    speak('Super! Great job!',()=>{
      level++; if(level>maxLevels) level=1;
      setTimeout(nextRound,800);
    });
  } else {
    div.style.transform='scale(0.9)';
    speak('Oops! Try again!');
    setTimeout(()=>{ div.style.transform='scale(1)'; },500);
  }
}

// Next round
function nextRound(){
  currentRoundType = getRoundType();
  if(currentRoundType==='findTarget') generateTargetRound();
  else if(currentRoundType==='findMissing') generateMissingRound();
  else if(currentRoundType==='findDifferent') generateDifferentRound();
}

// Exit
function exitGame(){ bgMusic.pause(); window.location.href='index.html'; }

startBtn.onclick = ()=>{ preloadImages(startGame); };
</script>
</body>
</html>

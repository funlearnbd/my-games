<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Kids Learning Game</title>
<style>
body {
  margin: 0;
  font-family: Comic Sans MS, Arial, sans-serif;
  background: linear-gradient(135deg, #ffecd2, #fcb69f);
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  height: 100vh;
  overflow: hidden;
}
#startScreen {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  text-align: center;
}
#startScreen h1 {
  font-size: 3em;
  color: #ff4081;
  text-shadow: 2px 2px 5px rgba(0,0,0,0.3);
  margin-bottom: 40px;
}
.start-button {
  font-size: 3em;
  padding: 25px 60px;
  border: none;
  border-radius: 60px;
  background: linear-gradient(45deg, gold, orange);
  color: white;
  cursor: pointer;
  animation: glow 1.5s infinite alternate;
  box-shadow: 0 0 30px gold;
}
@keyframes glow {
  from { box-shadow: 0 0 30px gold; }
  to   { box-shadow: 0 0 50px orange; }
}
.game-container {
  display: none;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  width: 100%;
  height: 100%;
  padding: 10px;
  box-sizing: border-box;
  text-align: center;
}
.top-bar {
  width: 100%;
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 15px;
}
.score {
  font-size: 1.8em;
  font-weight: bold;
  color: #2e7d32;
}
#question {
  font-size: 2em;
  margin: 20px 0;
  color: #333;
  text-align: center;
}
.option-container {
  border: 4px dashed #ff9800;
  padding: 15px;
  border-radius: 20px;
  margin: 20px 0;
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  grid-auto-rows: 180px;
  gap: 15px;
  background: rgba(255,255,255,0.2);
  justify-items: center;
  align-items: center;
}
.option {
  width: 180px;
  height: 180px;
  border-radius: 25px;
  background: white;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  transition: transform 0.3s, box-shadow 0.3s;
  box-shadow: 0 6px 12px rgba(0,0,0,0.25);
  position: relative;
}
.option img {
  max-width: 95%;
  max-height: 95%;
}
.option:hover { transform: scale(1.1); }
.star-effect {
  position: absolute;
  pointer-events: none;
  font-size: 2em;
  animation: starFloat 1s ease-out forwards;
}
@keyframes starFloat {
  from { opacity: 1; transform: translateY(0) scale(1); }
  to   { opacity: 0; transform: translateY(-50px) scale(2); }
}
.shine {
  animation: shineAnim 1s ease-out forwards;
}
@keyframes shineAnim {
  0% { transform: scale(0.5); opacity: 0; }
  50% { transform: scale(1.3); opacity: 1; }
  100% { transform: scale(1); opacity: 1; box-shadow: 0 0 20px gold; }
}
.congrats {
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  background: linear-gradient(135deg, #ffeb3b, #ff9800);
  padding: 50px;
  border-radius: 30px;
  font-size: 3em;
  color: white;
  text-align: center;
  box-shadow: 0 0 50px orange;
  display: none;
  z-index: 1000;
  overflow: hidden;
}
.congrats-star {
  position: absolute;
  font-size: 2em;
  color: gold;
  animation: starFly 2s forwards;
}
@keyframes starFly {
  0% { transform: translateY(100px) scale(0.5); opacity: 0; }
  50% { opacity: 1; transform: translateY(-50px) scale(1.2); }
  100% { transform: translateY(-150px) scale(1); opacity: 0; }
}
#exitBtn {
  font-size: 1.5em;
  padding: 10px 25px;
  border: none;
  border-radius: 20px;
  background: red;
  color: white;
  cursor: pointer;
  margin-bottom: 20px;
}
</style>
</head>
<body>
<div id="startScreen">
  <h1>🌟 Fun Learning Game 🌟</h1>
  <button id="startBtn" class="start-button">▶ Start Game</button>
</div>
<div id="game" class="game-container">
  <div class="top-bar">
    <div id="question"></div>
    <div id="score" class="score">Score: 0</div>
  </div>
  <div id="options"></div>
  <button id="exitBtn">Exit Game</button>
</div>
<div id="congrats" class="congrats"></div>

<audio id="correctSound" src="https://actions.google.com/sounds/v1/cartoon/clang_and_wobble.ogg"></audio>
<audio id="wrongSound" src="https://actions.google.com/sounds/v1/cartoon/wood_plank_flicks.ogg"></audio>
<audio id="congratsMusic" src="https://actions.google.com/sounds/v1/cartoon/party_horn.ogg"></audio>

<script>
const imageList = ["apple","ball","banana","car","cat","cherry","dog","fish","flower","orange"];
let currentMode = "find";
let voicesReady = false;
let score = 0;
let waitingNextRound = false;
const loadedImages = {};
const correctSound = document.getElementById("correctSound");
const wrongSound = document.getElementById("wrongSound");
const congratsMusic = document.getElementById("congratsMusic");
const scoreEl = document.getElementById("score");
const congratsEl = document.getElementById("congrats");
const startBtn = document.getElementById("startBtn");
const startScreen = document.getElementById("startScreen");
const game = document.getElementById("game");
const qEl = document.getElementById("question");
const optionsEl = document.getElementById("options");
const exitBtn = document.getElementById("exitBtn");

imageList.forEach(name => { loadedImages[name] = new Image(); loadedImages[name].src = `image/${name}.png`; });

startBtn.addEventListener("click", () => {
  voicesReady = true;
  startScreen.style.display = "none";
  game.style.display = "flex";
  score = 0;
  updateScore();
  nextRound();
});

exitBtn.addEventListener("click", () => { window.location.href='index.html'; });

function speak(text, callback=null) {
  if(!voicesReady) return;
  const utter = new SpeechSynthesisUtterance(text);
  utter.rate = 0.8;
  utter.pitch = 1.2;
  utter.onend = () => { if(callback) callback(); };
  speechSynthesis.speak(utter);
}

function updateScore() {
  scoreEl.textContent = `Score: ${score}`;
  if(score>0 && score%10===0 && !waitingNextRound){
    showCongratsPopup();
  }
}

function showCongratsPopup() {
  waitingNextRound = true;
  congratsEl.innerHTML = `🎉 Congratulations! 🎉<br>You have got ${score} points!`;
  congratsEl.style.display = 'block';
  congratsMusic.play();
  speak(`Congratulations, you have got ${score} points!`, () => {
    congratsEl.style.display = 'none';
    waitingNextRound = false;
    nextRound();
  });
  for(let i=0;i<20;i++){
    const star = document.createElement('div');
    star.className='congrats-star';
    star.style.left=Math.random()*window.innerWidth+'px';
    star.style.top=window.innerHeight+'px';
    congratsEl.appendChild(star);
    setTimeout(()=>star.remove(),2200);
  }
}

function shuffle(arr){ return arr.sort(()=>Math.random()-0.5); }

function nextRound() {
  if(waitingNextRound) return;
  optionsEl.innerHTML='';
  const modes=["find","different","missing"];
  currentMode = modes[Math.floor(Math.random()*modes.length)];
  if(currentMode==='find') startFindRound();
  else if(currentMode==='different') startDifferentRound();
  else startMissingRound();
}

function createOption(name, isCorrect, parent=optionsEl, blankDiv=null, missing=null){
  const div = document.createElement('div'); div.className='option';
  const img = document.createElement('img'); img.src = loadedImages[name].src;
  div.appendChild(img);
  div.onclick = ()=>{
    if(isCorrect){
      correctSound.play(); score++; updateScore();
      if(blankDiv && missing){
        blankDiv.innerHTML='';
        const correctImg = document.createElement('img');
        correctImg.src = loadedImages[missing].src;
        correctImg.className='shine';
        blankDiv.appendChild(correctImg);
        setTimeout(()=>{ if(!waitingNextRound) nextRound(); },1500);
      } else {
        addStars(div); setTimeout(()=>{ if(!waitingNextRound) nextRound(); },1500);
      }
      speak('Well done!');
    } else { wrongSound.play(); speak('Try again'); }
  };
  parent.appendChild(div);
}

function addStars(target){
  for(let i=0;i<5;i++){
    const star=document.createElement('div');
    star.className='star-effect';
    star.textContent='⭐';
    const rect=target.getBoundingClientRect();
    star.style.left=rect.left + rect.width/2 + 'px';
    star.style.top=rect.top + rect.height/2 + 'px';
    document.body.appendChild(star);
    setTimeout(()=>star.remove(),1000);
  }
}

function startFindRound(){
  const choices=shuffle([...imageList]).slice(0,4);
  const target=choices[Math.floor(Math.random()*choices.length)];
  qEl.textContent=`Find the ${target}`;
  speak(`Can you find the ${target}?`);
  choices.forEach(name => createOption(name,name===target));
}

function startDifferentRound(){
  const base=imageList[Math.floor(Math.random()*imageList.length)];
  let odd; do{ odd=imageList[Math.floor(Math.random()*imageList.length)]; }while(odd===base);
  const options=[base,base,base,odd];
  qEl.textContent="Find the different one!";
  speak('Which one is different?');
  shuffle(options).forEach(name => createOption(name,name===odd));
}

function startMissingRound(){
  // Step 1: pick 6 unique items
  const selected = shuffle([...imageList]).slice(0,6);

  // Step 2: choose exactly one to be missing
  const missing = selected[Math.floor(Math.random()*selected.length)];

  qEl.textContent = 'Which picture is missing?';
  speak('Which picture is missing?');

  // Step 3: show 5 items + 1 blank
  const questionContainer = document.createElement('div');
  questionContainer.className = 'option-container';
  let blankDiv = null;

  selected.forEach(name => {
    if(name === missing){
      blankDiv = document.createElement('div');
      blankDiv.className = 'option';
      questionContainer.appendChild(blankDiv);
    } else {
      createOption(name,false,questionContainer);
    }
  });
  optionsEl.appendChild(questionContainer);

  // Step 4: answers (missing + 2 distractors not in question set)
  const distractors = shuffle(imageList.filter(n => !selected.includes(n))).slice(0,2);
  const answerChoices = shuffle([missing, ...distractors]);

  const answerContainer = document.createElement('div');
  answerContainer.className = 'option-container';
  answerChoices.forEach(name => createOption(name, name===missing, answerContainer, blankDiv, missing));
  optionsEl.appendChild(answerContainer);
}

</script>
</body>
</html>
